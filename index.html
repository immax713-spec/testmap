<!DOCTYPE html>
<html>
<head>
    <title>–ö–∞—Ä—Ç–∞ –æ–±—ä–µ–∫—Ç–æ–≤ - –ê–ù–û "–°–ú–ì"</title>
    <meta http-equiv="Content-Type" content="text/html; charset=utf-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
    <meta name="apple-mobile-web-app-capable" content="yes">
    <meta name="apple-mobile-web-app-status-bar-style" content="black-translucent">
    <meta name="mobile-web-app-capable" content="yes">
    <meta name="theme-color" content="#8B0000">
    
    <script src="https://api-maps.yandex.ru/2.1/?lang=ru_RU&apikey=52007aca-39bd-4a9c-87ef-4d9b730aeb71" type="text/javascript"></script>
    
    <style>
        * { margin: 0; padding: 0; box-sizing: border-box; }
        body { font-family: Arial, sans-serif; height: 100vh; overflow: hidden; background: #f0f2f5; }

        /* üî• –°–¢–ò–õ–ò –õ–û–ì–ò–ù–ê */
        .login-overlay { 
            position: fixed; 
            top: 0; 
            left: 0; 
            width: 100%; 
            height: 100%; 
            background: rgba(0,0,0,0.8); 
            display: flex; 
            justify-content: center; 
            align-items: center; 
            z-index: 10000; 
            padding: 20px;
        }
        .login-container { 
            background: white; 
            padding: 25px; 
            border-radius: 15px; 
            box-shadow: 0 10px 30px rgba(0,0,0,0.3); 
            width: 100%; 
            max-width: 400px; 
        }
        .login-header { text-align: center; margin-bottom: 20px; }
        .login-header h2 { color: #8B0000; margin-bottom: 10px; font-size: 1.5rem; }
        .login-header p { font-size: 0.9rem; }
        .login-form { display: flex; flex-direction: column; gap: 15px; }
        .form-group { display: flex; flex-direction: column; }
        .form-group label { margin-bottom: 5px; font-weight: bold; color: #333; font-size: 0.9rem; }
        .form-group select, .form-group input { padding: 12px; border: 2px solid #ddd; border-radius: 8px; font-size: 16px; }
        .form-group select:focus, .form-group input:focus { border-color: #8B0000; outline: none; }
        .login-button { background: #8B0000; color: white; border: none; padding: 12px; border-radius: 8px; font-size: 16px; cursor: pointer; margin-top: 10px; }
        .login-button:hover { background: #a00; }
        
        /* üî• –ß–ï–ö–ë–û–ö–° –ó–ê–ü–û–ú–ù–ò–¢–¨ –ü–ê–†–û–õ–¨ */
.remember-password { display: flex; align-items: center; gap: 8px; margin: 10px 0; }
.remember-password input[type="checkbox"] { 
    width: 16px; 
    height: 16px; 
    margin: 0; 
    appearance: none;
    -webkit-appearance: none;
    border: 2px solid #333;
    border-radius: 3px;
    background: white;
    cursor: pointer;
    position: relative;
}
.remember-password input[type="checkbox"]:checked {
    background: white;
    border-color: #333;
}
.remember-password input[type="checkbox"]:checked::after {
    content: "‚úï";
    position: absolute;
    top: 50%;
    left: 50%;
    transform: translate(-50%, -50%);
    color: #000;
    font-size: 12px;
    font-weight: bold;
}
.remember-password label { margin-bottom: 0; font-weight: normal; color: #555; font-size: 14px; }

/* üî• –°–¢–ò–õ–ò –ß–ï–ö–ë–û–ö–°–û–í –í –§–ò–õ–¨–¢–†–ê–• */
.checkbox-item input[type="checkbox"] {
    appearance: none;
    -webkit-appearance: none;
    width: 18px;
    height: 18px;
    border: 2px solid #333;
    border-radius: 3px;
    background: white;
    cursor: pointer;
    position: relative;
    margin-right: 8px;
}

.checkbox-item input[type="checkbox"]:checked {
    background: white;
    border-color: #333;
}

.checkbox-item input[type="checkbox"]:checked::after {
    content: "‚úï";
    position: absolute;
    top: 50%;
    left: 50%;
    transform: translate(-50%, -50%);
    color: #000;
    font-size: 14px;
    font-weight: bold;
}

.checkbox-item input[type="checkbox"]:hover {
    border-color: #666;
}

        /* üî• –û–°–ù–û–í–ù–û–ô –ò–ù–¢–ï–†–§–ï–ô–° */
        .user-info { 
            position: absolute; 
            top: 10px; 
            right: 10px; 
            background: white; 
            padding: 8px 12px; 
            border-radius: 8px; 
            box-shadow: 0 2px 10px rgba(0,0,0,0.1); 
            z-index: 1000; 
            display: flex; 
            align-items: center; 
            gap: 8px; 
            font-size: 0.9rem;
        }
        .logout-btn { background: #e74c3c; color: white; border: none; padding: 5px 10px; border-radius: 4px; cursor: pointer; font-size: 0.8rem; }
        .logout-btn:hover { background: #c0392b; }

        /* üî• –£–ë–ò–†–ê–ï–ú –°–¢–ê–†–´–ï –ü–ê–ù–ï–õ–ò –£–ü–†–ê–í–õ–ï–ù–ò–Ø */
        .admin-controls, .inspector-controls, .work-day-status { 
            display: none !important; 
        }

        .container { display: flex; height: 100vh; flex-direction: row; }
        
        /* üî• –ü–ï–†–ï–î–ï–õ–ê–ù–ù–´–ô –°–ê–ô–î–ë–ê–† */
        .sidebar { 
            width: 400px; 
            height: 100vh; 
            background: white; 
            padding: 15px; 
            border-right: 2px solid #dee2e6; 
            overflow-y: auto; 
            box-shadow: 2px 0 10px rgba(0,0,0,0.1); 
            display: flex; 
            flex-direction: column;
            position: relative;
            z-index: 100;
            transition: transform 0.3s ease;
        }
        
        /* üî• –ö–ù–û–ü–ö–ê –°–ö–†–´–¢–ò–Ø –°–ê–ô–î–ë–ê–†–ê */
        .sidebar-toggle {
            position: absolute;
            top: 50%;
            right: -15px;
            transform: translateY(-50%);
            background: #8B0000;
            color: white;
            border: none;
            width: 15px;
            height: 60px;
            border-radius: 0 5px 5px 0;
            cursor: pointer;
            display: flex;
            align-items: center;
            justify-content: center;
            font-size: 12px;
            z-index: 101;
            box-shadow: 2px 0 5px rgba(0,0,0,0.2);
        }
        
        .sidebar.collapsed {
            transform: translateX(-385px);
        }
        
        .sidebar.collapsed .sidebar-toggle {
            right: -40px;
        }
        
        .map-container { 
            flex: 1; 
            position: relative; 
            height: 100vh; 
            transition: margin-left 0.3s ease;
        }
        
        #map { width: 100%; height: 100%; }

        .header { background: #8B0000; color: white; padding: 12px; border-radius: 8px; margin-bottom: 15px; text-align: left; }
        
        /* üî• –ù–û–í–´–ï –°–ï–ö–¶–ò–ò –£–ü–†–ê–í–õ–ï–ù–ò–Ø –í –°–ê–ô–î–ë–ê–†–ï */
        .control-section {
            background: #f8f9fa;
            padding: 12px;
            border-radius: 8px;
            margin-bottom: 15px;
            border: 1px solid #dee2e6;
        }
        
        .control-section-title {
            font-weight: bold;
            margin-bottom: 10px;
            color: #2c3e50;
            font-size: 0.9rem;
            display: flex;
            align-items: center;
            gap: 8px;
        }

        /* üî• –ö–ù–û–ü–ö–ò –§–ò–õ–¨–¢–†–û–í (–æ—Ä–∏–≥–∏–Ω–∞–ª—å–Ω—ã–π —Ä–∞–∑–º–µ—Ä –∫–∞–∫ "–í—ã–±—Ä–∞—Ç—å –≤—Å–µ—Ö") */
.control-button, .list-control-button {
    padding: 8px;
    border: none;
    border-radius: 5px;
    cursor: pointer;
    font-size: 0.85rem;
    font-weight: bold;
    text-align: center;
    background: #3498db;
    color: white;
    transition: all 0.3s ease;
    flex: 1;
}

/* üî• –ê–î–ú–ò–ù–°–ö–ò–ï –ö–ù–û–ü–ö–ò (—Ç–∞–∫–æ–π –∂–µ —Å—Ç–∏–ª—å, –Ω–æ –º–µ–Ω—å—à–µ) */
.admin-btn, .inspector-btn, .close-day-btn {
    padding: 6px 8px;
    border: none;
    border-radius: 5px;
    cursor: pointer;
    font-size: 0.75rem;
    font-weight: bold;
    text-align: center;
    background: #3498db;
    color: white;
    transition: all 0.3s ease;
    text-decoration: none;
    display: inline-block;
    width: 100%;
    margin-bottom: 4px;
}

/* –•–æ–≤–µ—Ä-—ç—Ñ—Ñ–µ–∫—Ç—ã –¥–ª—è –≤—Å–µ—Ö –∫–Ω–æ–ø–æ–∫ */
.control-button:hover, .list-control-button:hover, .admin-btn:hover, .inspector-btn:hover, .close-day-btn:hover {
    background: #2980b9;
    transform: translateY(-1px);
    box-shadow: 0 2px 4px rgba(0,0,0,0.2);
}

/* üî• –¶–í–ï–¢–ê –î–õ–Ø –†–ê–ó–ù–´–• –¢–ò–ü–û–í –ö–ù–û–ü–û–ö */
.admin-btn { 
    background: #3498db; 
}
.admin-btn:hover { 
    background: #2980b9; 
}

.inspector-btn { 
    background: #90EE90; 
    color: #006400; 
}
.inspector-btn:hover { 
    background: #7CFC00; 
    color: #006400; 
}

.close-day-btn { 
    background: #FFB6C1; 
    color: #8B0000; 
}
.close-day-btn:hover { 
    background: #FF69B4; 
    color: #8B0000; 
}

.close-day-btn:disabled {
    opacity: 0.5;
    cursor: not-allowed;
    background: #FFB6C1;
    color: #8B0000;
}

.close-day-btn:disabled:hover {
    background: #FFB6C1;
    color: #8B0000;
    transform: none;
    box-shadow: none;
}

/* üî• –°–ï–¢–ö–ê –î–õ–Ø –ê–î–ú–ò–ù–°–ö–ò–• –ö–ù–û–ü–û–ö */
.control-buttons-grid {
    display: grid;
    grid-template-columns: 1fr 1fr;
    gap: 6px;
    margin-bottom: 8px;
}

/* üî• –ö–ù–û–ü–ö–ò –í –§–ò–õ–¨–¢–†–ê–• */
.control-buttons, .list-control-buttons {
    display: flex;
    gap: 8px;
    margin-bottom: 12px;
}
        .work-day-indicator {
            padding: 8px;
            border-radius: 5px;
            font-weight: bold;
            font-size: 0.8rem;
            text-align: center;
            margin-top: 8px;
            border: 2px solid;
        }
        
        .work-day-indicator.open { 
            background: #d4edda; 
            color: #155724; 
            border-color: #c3e6cb; 
        }
        
        .work-day-indicator.closed { 
            background: #f8d7da; 
            color: #721c24; 
            border-color: #f1b0b7; 
        }

        .filter-section { margin-bottom: 15px; }
        .filter-title { font-weight: bold; margin-bottom: 8px; color: #333; font-size: 0.9rem; }
        .checkbox-group { max-height: 150px; overflow-y: auto; border: 1px solid #ddd; padding: 8px; border-radius: 5px; background: white; }
        .checkbox-item { margin-bottom: 6px; display: flex; align-items: center; padding: 4px; font-size: 0.85rem; }
        .checkbox-item input { margin-right: 6px; }
        .color-dot { width: 10px; height: 10px; border-radius: 50%; margin-right: 6px; display: inline-block; }
        .inspector-icon { margin-right: 6px; font-size: 14px; }
        .inspector-counter { margin-left: auto; font-size: 10px; font-weight: bold; color: #666; background: #f8f9fa; padding: 2px 5px; border-radius: 10px; border: 1px solid #dee2e6; min-width: 25px; text-align: center; }
        .inspector-counter.completed { color: #27ae60; background: #d4edda; border-color: #c3e6cb; }
        .inspector-counter.admin { color: #00FF7F; background: #e6fff2; border-color: #00FF7F; }
        .inspector-counter.inactive { color: #999; background: #f0f0f0; border-color: #ddd; }

        /* üî• –°–ß–ï–¢–ß–ò–ö–ò –î–õ–Ø –°–ü–ò–°–ö–û–í */
        .list-counter { font-size: 10px; font-weight: bold; color: #666; background: #f8f9fa; padding: 2px 5px; border-radius: 10px; border: 1px solid #dee2e6; margin-left: 6px; }

        .search-box { width: 100%; padding: 8px; margin-bottom: 12px; border: 1px solid #ddd; border-radius: 5px; font-size: 0.9rem; }
        .control-buttons { display: flex; gap: 8px; margin-bottom: 12px; }
        .control-button { flex: 1; padding: 8px; border: none; border-radius: 5px; cursor: pointer; background: #3498db; color: white; font-size: 0.85rem; }
        .control-button:hover { background: #2980b9; }

        /* üî• –ò–°–ü–†–ê–í–õ–ï–ù–ù–´–ï –°–¢–ò–õ–ò –î–õ–Ø –§–ò–õ–¨–¢–†–û–í –°–ü–ò–°–ö–û–í */
        .list-control-buttons { display: flex; gap: 8px; margin-bottom: 12px; }
        .list-control-button { flex: 1; padding: 8px; border: none; border-radius: 5px; cursor: pointer; background: #3498db; color: white; font-size: 0.85rem; }
        .list-control-button:hover { background: #2980b9; }

        .stats { background: #34495e; color: white; padding: 12px; border-radius: 8px; margin-top: 12px; font-size: 0.85rem; text-align: center; }
        .refresh-btn { background: #e74c3c; color: white; border: none; padding: 8px; border-radius: 5px; cursor: pointer; width: 100%; margin-bottom: 12px; font-size: 0.85rem; }
        .refresh-btn:hover { background: #c0392b; }
        .refresh-btn.force { background: #e67e22; }
        .refresh-btn.force:hover { background: #d35400; }

        .notification { 
            position: fixed; 
            top: 10px; 
            right: 10px; 
            padding: 12px 15px; 
            border-radius: 5px; 
            color: white; 
            z-index: 1000; 
            font-weight: bold; 
            max-width: 280px; 
            font-size: 0.9rem;
        }
        .notification.success { background: #27ae60; }
        .notification.error { background: #e74c3c; }

        /* üî• –¢–ê–ë–´ –ò –°–ü–ò–°–ö–ò –û–ë–™–ï–ö–¢–û–í */
        .tab-buttons { display: flex; margin-bottom: 12px; border-bottom: 2px solid #dee2e6; }
        .tab-button { flex: 1; padding: 8px; background: none; border: none; cursor: pointer; font-size: 0.85rem; font-weight: bold; color: #6c757d; border-bottom: 2px solid transparent; }
        .tab-button.active { color: #3498db; border-bottom: 2px solid #3498db; }
        .tab-content { flex: 1; display: flex; flex-direction: column; }
        .tab-pane { flex: 1; display: none; flex-direction: column; }
        .tab-pane.active { display: flex; }

        .objects-list { flex: 1; overflow-y: auto; border: 1px solid #ddd; border-radius: 5px; margin-top: 15px; background: white; }
        .objects-list-title { background: #34495e; color: white; padding: 8px; font-weight: bold; text-align: center; border-radius: 5px 5px 0 0; font-size: 0.9rem; }
        .object-item { padding: 8px; border-bottom: 1px solid #eee; cursor: pointer; display: flex; align-items: center; font-size: 0.85rem; }
        .object-item:hover { background: #f8f9fa; }
        .object-item:last-child { border-bottom: none; }
        .object-id { font-weight: bold; color: #2c3e50; margin-right: 6px; }
        .object-address { flex: 1; font-size: 0.8rem; color: #555; }
        .object-inspector { font-size: 0.75rem; color: #7f8c8d; margin-top: 2px; }
        .object-status { margin-left: 8px; font-size: 9px; padding: 2px 5px; border-radius: 8px; }

        /* üî• –°–¢–ò–õ–ò –ë–ê–õ–õ–£–ù–û–í –ò –ö–ù–û–ü–û–ö */
        .coordinates-btn { background: #9b59b6; color: white; border: none; padding: 6px 10px; border-radius: 4px; cursor: pointer; font-size: 0.8rem; margin: 2px; flex: 1; }
        .coordinates-btn:hover { background: #8e44ad; }
        .checklist-btn { background: #e67e22; color: white; border: none; padding: 6px 10px; border-radius: 4px; cursor: pointer; font-size: 0.8rem; margin: 2px; text-decoration: none; display: inline-block; text-align: center; flex: 1; }
        .checklist-btn:hover { background: #d35400; }
        .yandex-disk-btn { background: #ffcc00; color: #000; border: none; padding: 6px 10px; border-radius: 4px; cursor: pointer; font-size: 0.8rem; margin: 2px; text-decoration: none; display: inline-block; text-align: center; flex: 1; font-weight: bold; }
        .yandex-disk-btn:hover { background: #e6b800; }
        .button-group { display: flex; gap: 4px; margin-top: 8px; flex-wrap: wrap; }
        .entry-exit-buttons { display: flex; gap: 4px; margin-top: 8px; }
        .entry-exit-buttons button { flex: 1; padding: 8px; border: none; border-radius: 4px; cursor: pointer; font-size: 0.8rem; font-weight: bold; }
        .entry-btn { background: #3498db; color: white; }
        .entry-btn:hover { background: #2980b9; }
        .exit-btn { background: #27ae60; color: white; }
        .exit-btn:hover { background: #219a52; }
        .cancel-entry-btn { background: #e74c3c; color: white; }
        .cancel-entry-btn:hover { background: #c0392b; }

        .reassign-select { width: 100%; padding: 6px; border: 2px solid #3498db; border-radius: 4px; margin-top: 5px; font-size: 0.8rem; }
        .status-badge { display: inline-block; padding: 2px 6px; border-radius: 12px; font-size: 10px; font-weight: bold; margin: 4px 0; color: white; }
        .status-new { background: #e74c3c; }
        .status-completed { background: #27ae60; }
        .status-active { background: #3498db; }

        .entry-warning { background: #fff3cd; color: #856404; padding: 6px; border-radius: 4px; border: 1px solid #ffeaa7; margin-top: 5px; font-size: 0.75rem; text-align: center; }

        /* üî• –°–¢–ò–õ–ò –£–ü–†–ê–í–õ–ï–ù–ò–Ø –ò–ù–°–ü–ï–ö–¢–û–†–ê–ú–ò */
        .filter-access-menu, .inspector-management-menu { 
    position: fixed; 
    top: 280px; /* üî• –§–ò–ö–°–ò–†–û–í–ê–ù–ù–û–ï –ó–ù–ê–ß–ï–ù–ò–ï –í PX */
    left: 50%; 
    transform: translateX(-50%); /* üî• –£–ë–ò–†–ê–ï–ú translateY */
    background: white; 
    padding: 15px; 
    border-radius: 10px; 
    box-shadow: 0 5px 30px rgba(0,0,0,0.3); 
    z-index: 10000; 
    display: none; 
    flex-direction: column; 
    gap: 12px; 
    width: 95%; 
    max-width: 500px; 
    max-height: 70vh; 
    overflow-y: auto; 
}

        .filter-access-title { font-weight: bold; color: #333; margin-bottom: 8px; text-align: center; font-size: 1rem; }
        .filter-access-section { margin-bottom: 12px; }
        .filter-access-section-title { font-weight: bold; margin-bottom: 8px; color: #555; font-size: 0.85rem; }
        .filter-access-item { display: flex; align-items: center; gap: 8px; padding: 4px 0; border-bottom: 1px solid #f0f0f0; font-size: 0.85rem; }
        .filter-access-all { border-top: 2px solid #ddd; padding-top: 8px; margin-top: 8px; }
        
        .filter-access-buttons, .inspector-management-buttons { 
            display: flex; gap: 8px; margin-top: 12px; position: sticky; bottom: 0; 
            background: white; padding: 12px 0; border-top: 2px solid #ddd; 
        }
        .filter-access-buttons button, .inspector-management-buttons button { 
            flex: 1; padding: 10px; border: none; border-radius: 5px; cursor: pointer; font-size: 0.85rem; font-weight: bold; 
        }
        .save-access-btn, .save-management-btn { background: #27ae60; color: white; }
        .save-access-btn:hover, .save-management-btn:hover { background: #219a52; }
        .cancel-access-btn, .cancel-management-btn { background: #95a5a6; color: white; }
        .cancel-access-btn:hover, .cancel-management-btn:hover { background: #7f8c8d; }

        .accordion { border: 1px solid #ddd; border-radius: 5px; margin-bottom: 8px; }
        .accordion-header { background: #f8f9fa; padding: 10px 12px; cursor: pointer; display: flex; justify-content: space-between; align-items: center; font-weight: bold; font-size: 0.85rem; }
        .accordion-header:hover { background: #e9ecef; }
        .accordion-content { padding: 12px; border-top: 1px solid #ddd; display: none; }
        .accordion-content.active { display: block; }

        .search-management { width: 100%; padding: 8px; margin-bottom: 12px; border: 1px solid #ddd; border-radius: 5px; font-size: 0.85rem; }
        .management-section { margin-bottom: 12px; }
        .management-section-title { font-weight: bold; margin-bottom: 6px; color: #555; font-size: 0.85rem; }
        .management-controls { display: flex; gap: 8px; align-items: center; }
        .color-preview { width: 18px; height: 18px; border-radius: 50%; border: 2px solid #ddd; }
        
        /* üî• –ö–†–ê–°–ò–í–ê–Ø –ö–ù–û–ü–ö–ê –ü–†–ò–ú–ï–ù–ò–¢–¨ –ò–ó–ú–ï–ù–ï–ù–ò–Ø */
        .apply-changes-btn {
            background: linear-gradient(135deg, #27ae60, #219a52);
            color: white;
            border: none;
            padding: 10px 15px;
            border-radius: 8px;
            cursor: pointer;
            font-size: 0.85rem;
            font-weight: bold;
            transition: all 0.3s ease;
            box-shadow: 0 4px 8px rgba(39, 174, 96, 0.3);
            width: 100%;
            margin-top: 8px;
        }
        .apply-changes-btn:hover {
            background: linear-gradient(135deg, #219a52, #1e8449);
            transform: translateY(-2px);
            box-shadow: 0 6px 12px rgba(39, 174, 96, 0.4);
        }
        .apply-changes-btn:active {
            transform: translateY(0);
            box-shadow: 0 2px 4px rgba(39, 174, 96, 0.3);
        }

        .select-all-btn { background: #f8f9fa; color: #333; border: 1px solid #ddd; padding: 6px 10px; border-radius: 4px; cursor: pointer; font-size: 0.75rem; margin-bottom: 8px; width: 100%; }
        .select-all-btn:hover { background: #e9ecef; border-color: #adb5bd; }

        .color-palette { display: flex; flex-wrap: wrap; gap: 6px; margin-top: 5px; }
        .color-option { width: 25px; height: 25px; border-radius: 50%; border: 2px solid #ddd; cursor: pointer; transition: all 0.2s; }
        .color-option:hover { transform: scale(1.1); border-color: #333; }
        .color-option.selected { border-color: #333; transform: scale(1.2); box-shadow: 0 0 5px rgba(0,0,0,0.3); }

        .icon-select, .status-select { width: 100%; padding: 6px; border: 2px solid #3498db; border-radius: 4px; margin-top: 5px; font-size: 0.85rem; }

        /* üî• –ú–û–ë–ò–õ–¨–ù–´–ô –†–ï–ñ–ò–ú - –ö–ù–û–ü–ö–ê –ü–ê–ù–ï–õ–ò –£–ü–†–ê–í–õ–ï–ù–ò–Ø */
      .mobile-toggle-btn {
    position: fixed;
    top: 100px;  
    right: 25px; 
    background: #3498db;
    color: white;
    border: none;
    padding: 8px 12px;
    border-radius: 5px;
    cursor: pointer;
    font-size: 0.9rem;
    z-index: 1001;
    box-shadow: 0 2px 10px rgba(0,0,0,0.2);
    display: none;
}

.mobile-toggle-btn:hover {
    background: #2980b9;
}

/* üî• –ë–õ–û–ö –ü–û–õ–¨–ó–û–í–ê–¢–ï–õ–Ø */
.user-info { 
    position: fixed; 
    top: 60px; 
    right: 30px; 
    background: white; 
    padding: 8px 12px; 
    border-radius: 8px; 
    box-shadow: 0 2px 10px rgba(0,0,0,0.1); 
    z-index: 1000; 
    display: flex; 
    align-items: center; 
    gap: 8px; 
    font-size: 0.9rem;
}
        
        .mobile-toggle-btn:hover {
            background: #2980b9;
        }

        /* üî• –°–¢–ò–õ–ò –î–õ–Ø –ë–ê–õ–õ–£–ù–û–í */
        .balloon-content {
            max-width: 280px;
            padding: 10px;
        }
        
        /* üî• –ê–î–ê–ü–¢–ò–í–ù–´–ï –°–¢–ò–õ–ò –î–õ–Ø –ú–û–ë–ò–õ–¨–ù–´–• */
        @media (max-width: 768px) {
            .container { 
                flex-direction: column; 
                height: 100vh;
            }
            
            .sidebar { 
                position: fixed;
                top: 0;
                left: 0;
                width: 100%;
                height: 100%;
                z-index: 1000;
                transform: translateX(-100%);
                transition: transform 0.3s ease;
                border-right: none;
                overflow-y: auto;
            }
            
            .sidebar.mobile-open {
                transform: translateX(0);
            }
            
            .sidebar-toggle {
                display: none;
            }
            
            .map-container {
                margin-left: 0 !important;
                height: 100vh;
            }
            
            .mobile-toggle-btn {
                display: block;
            }
            
            .user-info {
                top: 60px;
                right: 10px;
            }
            
            .filter-access-menu, .inspector-management-menu { 
                width: 98%; 
                max-width: 98%;
            }
            
            .balloon-content {
                max-width: 250px;
                padding: 8px;
            }
        }

        /* üî• –£–õ–£–ß–®–ï–ù–ù–´–ï –°–¢–ò–õ–ò –î–õ–Ø –ú–û–ë–ò–õ–¨–ù–´–• –£–°–¢–†–û–ô–°–¢–í */
        @media (max-width: 480px) {
            .login-container { padding: 20px; }
            .login-header h2 { font-size: 1.3rem; }
            .login-header p { font-size: 0.8rem; }
            
            .user-info { padding: 6px 10px; font-size: 0.8rem; }
            .logout-btn { padding: 4px 8px; font-size: 0.75rem; }
            
            .sidebar { padding: 12px; }
            .header { padding: 10px; margin-bottom: 12px; }
            
            .control-buttons-grid {
                grid-template-columns: 1fr;
            }
            
            .filter-access-menu, .inspector-management-menu { 
                padding: 12px; 
                width: 98%; 
            }
            
            .balloon-content {
                max-width: 220px;
                padding: 6px;
            }
        }
    </style>
</head>
<body>
    <!-- üî• –ú–ï–ù–Æ –õ–û–ì–ò–ù–ê -->
    <div class="login-overlay" id="loginOverlay">
        <div class="login-container">
            <div class="login-header">
                <h2>–ê–ù–û "–°–ú–ì"</h2>
                <p>–î–µ–ø–∞—Ä—Ç–∞–º–µ–Ω—Ç –≥—Ä–∞–¥–æ—Å—Ç—Ä–æ–∏—Ç–µ–ª—å–Ω–æ–π –ø–æ–ª–∏—Ç–∏–∫–∏ –≥–æ—Ä–æ–¥–∞ –ú–æ—Å–∫–≤—ã</p>
            </div>
            <div class="login-form">
                <div class="form-group">
                    <label for="userSelect">–í—ã–±–µ—Ä–∏—Ç–µ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è:</label>
                    <select id="userSelect">
                        <option value="">-- –ó–∞–≥—Ä—É–∑–∫–∞ –∏–Ω—Å–ø–µ–∫—Ç–æ—Ä–æ–≤... --</option>
                    </select>
                </div>
                <div class="form-group">
                    <label for="passwordInput">–ü–∞—Ä–æ–ª—å:</label>
                    <input type="password" id="passwordInput" placeholder="–í–≤–µ–¥–∏—Ç–µ –ø–∞—Ä–æ–ª—å">
                </div>
                <!-- üî• –ß–ï–ö–ë–û–ö–° –ó–ê–ü–û–ú–ù–ò–¢–¨ –ü–ê–†–û–õ–¨ -->
                <div class="remember-password">
                    <input type="checkbox" id="rememberPassword">
                    <label for="rememberPassword">üíæ –ó–∞–ø–æ–º–Ω–∏—Ç—å –ø–∞—Ä–æ–ª—å</label>
                </div>
                <button class="login-button" onclick="login()">–í–æ–π—Ç–∏</button>
                <!-- üî• –ö–ù–û–ü–ö–ê –û–ë–ù–û–í–õ–ï–ù–ò–Ø –ò–ù–°–ü–ï–ö–¢–û–†–û–í -->
                <button class="refresh-btn" onclick="refreshInspectorsList()" style="background: #9b59b6;">üîÑ –û–±–Ω–æ–≤–∏—Ç—å —Å–ø–∏—Å–æ–∫ –∏–Ω—Å–ø–µ–∫—Ç–æ—Ä–æ–≤</button>
            </div>
        </div>
    </div>

    <!-- üî• –ö–ù–û–ü–ö–ê –ú–û–ë–ò–õ–¨–ù–û–ô –ü–ê–ù–ï–õ–ò -->
    <button class="mobile-toggle-btn" id="mobileToggleBtn" onclick="toggleMobileSidebar()">üì± –ü–∞–Ω–µ–ª—å</button>

    <!-- üî• –û–°–ù–û–í–ù–û–ô –ò–ù–¢–ï–†–§–ï–ô–° -->
    <div class="user-info" id="userInfo" style="display: none;">
        <span id="currentUser"></span>
        <button class="logout-btn" onclick="logout()">–í—ã–π—Ç–∏</button>
    </div>

    <!-- üî• –ú–ï–ù–Æ –î–û–°–¢–£–ü–ê –ö –§–ò–õ–¨–¢–†–ê–ú -->
    <div class="filter-access-menu" id="filterAccessMenu">
        <div class="filter-access-title">üîì –ù–∞—Å—Ç—Ä–æ–π–∫–∞ –¥–æ—Å—Ç—É–ø–∞ –∫ —Ñ–∏–ª—å—Ç—Ä–∞–º</div>
        
        <input type="text" class="search-management" id="searchAccess" placeholder="üîç –ü–æ–∏—Å–∫ –ø–æ –∏–Ω—Å–ø–µ–∫—Ç–æ—Ä–∞–º..." onkeyup="filterAccessInspectors()">
        
        <div class="filter-access-buttons">
            <button class="save-access-btn" onclick="saveFilterAccess()">üíæ –°–æ—Ö—Ä–∞–Ω–∏—Ç—å –Ω–∞—Å—Ç—Ä–æ–π–∫–∏ –¥–æ—Å—Ç—É–ø–∞</button>
        </div>
        
        <div class="filter-access-all">
            <div class="filter-access-item">
                <input type="checkbox" id="accessAll" onchange="toggleAllFilterAccess()">
                <label for="accessAll"><strong>–í—ã–¥–∞—Ç—å –¥–æ—Å—Ç—É–ø –≤—Å–µ–º</strong></label>
            </div>
        </div>
        <div id="filterAccessContent" style="max-height: 400px; overflow-y: auto;"></div>
    </div>

    <!-- üî• –ú–ï–ù–Æ –£–ü–†–ê–í–õ–ï–ù–ò–Ø –ò–ù–°–ü–ï–ö–¢–û–†–ê–ú–ò -->
    <div class="inspector-management-menu" id="inspectorManagementMenu">
        <div class="filter-access-title">üë• –£–ø—Ä–∞–≤–ª–µ–Ω–∏–µ –∏–Ω—Å–ø–µ–∫—Ç–æ—Ä–∞–º–∏</div>
        
        <input type="text" class="search-management" id="searchManagement" placeholder="üîç –ü–æ–∏—Å–∫ –ø–æ –∏–Ω—Å–ø–µ–∫—Ç–æ—Ä–∞–º..." onkeyup="filterManagementInspectors()">
        
        <div id="inspectorManagementContent" style="max-height: 500px; overflow-y: auto;"></div>
    </div>

    <!-- üî• –û–°–ù–û–í–ù–û–ô –ö–û–ù–¢–ï–ô–ù–ï–† -->
    <div class="container" id="mainContainer" style="display: none;">
        <!-- üî• –°–ê–ô–î–ë–ê–† –° –í–°–ï–ú–ò –≠–õ–ï–ú–ï–ù–¢–ê–ú–ò –£–ü–†–ê–í–õ–ï–ù–ò–Ø -->
        <div class="sidebar" id="sidebar">
            <!-- üî• –ö–ù–û–ü–ö–ê –°–ö–†–´–¢–ò–Ø –°–ê–ô–î–ë–ê–†–ê -->
            <button class="sidebar-toggle" id="sidebarToggle" onclick="toggleSidebar()">‚óÄ</button>
            
            <div class="header">
                <div style="display: flex; align-items: center; gap: 15px;">
                    <div style="font-size: 24px;">üèõÔ∏è</div>
                    <div>
                        <h2 style="margin: 0; font-size: 18px; color: white;">–ê–ù–û "–°–ú–ì"</h2>
                        <p style="margin: 5px 0 0 0; font-size: 12px; color: white; opacity: 0.9;">
                            –î–µ–ø–∞—Ä—Ç–∞–º–µ–Ω—Ç –≥—Ä–∞–¥–æ—Å—Ç—Ä–æ–∏—Ç–µ–ª—å–Ω–æ–π –ø–æ–ª–∏—Ç–∏–∫–∏ –≥–æ—Ä–æ–¥–∞ –ú–æ—Å–∫–≤—ã
                        </p>
                    </div>
                </div>
            </div>

            <!-- üî• –°–ï–ö–¶–ò–Ø –£–ü–†–ê–í–õ–ï–ù–ò–Ø –†–ê–ë–û–ß–ò–ú –î–ù–ï–ú (–î–õ–Ø –ò–ù–°–ü–ï–ö–¢–û–†–û–í) -->
            <div class="control-section" id="workDaySection" style="display: none;">
                <div class="control-section-title">üìÖ –£–ø—Ä–∞–≤–ª–µ–Ω–∏–µ —Ä–∞–±–æ—á–∏–º –¥–Ω–µ–º</div>
                <div class="control-buttons-grid">
                   <button class="inspector-btn" id="openDayBtn" onclick="startWorkDay()">üü¢ –û—Ç–∫—Ä—ã—Ç—å –¥–µ–Ω—å</button>
<button class="inspector-btn close-day-btn" id="closeDayBtn" onclick="endWorkDay()" disabled>üî¥ –ó–∞–∫—Ä—ã—Ç—å –¥–µ–Ω—å</button>
                </div>
                <div class="work-day-indicator closed" id="workDayIndicator">–°—Ç–∞—Ç—É—Å: –î–µ–Ω—å –∑–∞–∫—Ä—ã—Ç</div>
            </div>

            <!-- üî• –°–ï–ö–¶–ò–Ø –ê–î–ú–ò–ù–ò–°–¢–†–ê–¢–û–†–ê -->
            <div class="control-section" id="adminSection" style="display: none;">
                <div class="control-section-title">‚öôÔ∏è –ê–¥–º–∏–Ω–∏—Å—Ç—Ä–∞—Ç–∏–≤–Ω—ã–µ —Ñ—É–Ω–∫—Ü–∏–∏</div>
                <div class="control-buttons-grid">
                    <button class="admin-btn" onclick="toggleInspectorsHomes()">üè† –ü–æ–∫–∞–∑–∞—Ç—å –∏–Ω—Å–ø–µ–∫—Ç–æ—Ä–æ–≤</button>
                    <button class="admin-btn" id="managementBtn" onclick="toggleInspectorsManagement()">üë• –£–ø—Ä–∞–≤–ª–µ–Ω–∏–µ –∏–Ω—Å–ø–µ–∫—Ç–æ—Ä–∞–º–∏</button>
                    <button class="admin-btn" id="accessBtn" onclick="toggleFilterAccessMenu()">üîì –î–æ—Å—Ç—É–ø –∫ —Ñ–∏–ª—å—Ç—Ä–∞–º</button>
                </div>
            </div>

            <!-- üî• –¢–ê–ë–´ -->
            <div class="tab-buttons">
                <button class="tab-button active" onclick="switchTab('filters')">–§–∏–ª—å—Ç—Ä—ã</button>
                <button class="tab-button" onclick="switchTab('objects')">–°–ø–∏—Å–æ–∫ –æ–±—ä–µ–∫—Ç–æ–≤</button>
            </div>

            <div class="tab-content">
                <!-- üî• –í–ö–õ–ê–î–ö–ê –§–ò–õ–¨–¢–†–û–í -->
                <div class="tab-pane active" id="filters-tab">
                    <div class="filter-section">
                        <div class="filter-title">üîç –ü–æ–∏—Å–∫ –æ–±—ä–µ–∫—Ç–∞</div>
                        <input type="text" id="searchInput" class="search-box" placeholder="–í–≤–µ–¥–∏—Ç–µ –Ω–æ–º–µ—Ä —Ç–æ—á–∫–∏ –∏–ª–∏ –∞–¥—Ä–µ—Å..." onkeyup="updateFilters()">
                    </div>

                    <div class="filter-section">
                        <div class="filter-title">üë§ –§–∏–ª—å—Ç—Ä –ø–æ –∏–Ω—Å–ø–µ–∫—Ç–æ—Ä–∞–º</div>
                        <input type="text" id="searchInspectors" class="search-box" placeholder="üîç –ü–æ–∏—Å–∫ –ø–æ –∏–Ω—Å–ø–µ–∫—Ç–æ—Ä–∞–º..." onkeyup="filterInspectorsList()">
                        <div class="control-buttons">
    <button class="control-button" onclick="selectAllInspectors(); saveFilterState();">–í—ã–±—Ä–∞—Ç—å –≤—Å–µ—Ö</button>
    <button class="control-button" onclick="deselectAllInspectors(); saveFilterState();">–°–±—Ä–æ—Å–∏—Ç—å –≤—Å–µ—Ö</button>
</div>
                        <div class="checkbox-group" id="inspectorsList">
                            <div class="loading">–ó–∞–≥—Ä—É–∑–∫–∞ –∏–Ω—Å–ø–µ–∫—Ç–æ—Ä–æ–≤...</div>
                        </div>
                    </div>

                    <div class="filter-section">
                        <div class="filter-title">üìã –§–∏–ª—å—Ç—Ä –ø–æ —Å–ø–∏—Å–∫–∞–º</div>
                        <div class="list-control-buttons">
    <button class="list-control-button" onclick="selectAllLists(); saveFilterState();">–í—ã–±—Ä–∞—Ç—å –≤—Å–µ</button>
    <button class="list-control-button" onclick="deselectAllLists(); saveFilterState();">–°–±—Ä–æ—Å–∏—Ç—å –≤—Å–µ</button>
</div>
                        <div class="checkbox-group" id="listsList">
                            <div class="loading">–ó–∞–≥—Ä—É–∑–∫–∞ —Å–ø–∏—Å–∫–æ–≤...</div>
                        </div>
                    </div>

                    <div class="filter-section">
                        <div class="filter-title">‚öôÔ∏è –ù–∞—Å—Ç—Ä–æ–π–∫–∏ –æ—Ç–æ–±—Ä–∞–∂–µ–Ω–∏—è</div>
                        <div class="checkbox-item">
                            <input type="checkbox" id="showHidden" onchange="updateFilters(); saveFilterState();">
                            <label for="showHidden"> –ú–û–ù–ò–¢–û–†–ò–ù–ì –ó–ê–í–ï–†–®–ï–ù ‚úÖ </label>
                        </div>
                    </div>

                    <div class="stats">
                        <!-- üî• –¢–û–õ–¨–ö–û –û–î–ù–ê –ö–ù–û–ü–ö–ê –û–ë–ù–û–í–õ–ï–ù–ò–Ø -->
                        <button class="refresh-btn force" onclick="forceRefreshData()">‚ö° –ü—Ä–∏–Ω—É–¥–∏—Ç–µ–ª—å–Ω–æ–µ –æ–±–Ω–æ–≤–ª–µ–Ω–∏–µ</button>
                        <div>üìä –°—Ç–∞—Ç–∏—Å—Ç–∏–∫–∞:</div>
                        <div id="objectsCounter">–ü–æ–∫–∞–∑–∞–Ω–æ: 0 –∏–∑ 0 –æ–±—ä–µ–∫—Ç–æ–≤</div>
                        <div id="completedCounter">–í—ã–ø–æ–ª–Ω–µ–Ω–æ: 0 –æ–±—ä–µ–∫—Ç–æ–≤</div>
                        <div id="activeCounter" style="margin-top: 5px; font-size: 12px; color: #3498db;"></div>
                    </div>
                </div>

                <!-- üî• –í–ö–õ–ê–î–ö–ê –°–ü–ò–°–ö–ê –û–ë–™–ï–ö–¢–û–í -->
                <div class="tab-pane" id="objects-tab">
                    <div class="filter-section">
                        <div class="filter-title">üîç –ü–æ–∏—Å–∫ –≤ —Å–ø–∏—Å–∫–µ</div>
                        <input type="text" id="searchListInput" class="search-box" placeholder="–í–≤–µ–¥–∏—Ç–µ –Ω–æ–º–µ—Ä —Ç–æ—á–∫–∏ –∏–ª–∏ –∞–¥—Ä–µ—Å..." onkeyup="updateObjectsList()">
                    </div>
                    <div class="objects-list">
                        <div class="objects-list-title">üìã –°–ø–∏—Å–æ–∫ –æ–±—ä–µ–∫—Ç–æ–≤</div>
                        <div id="objectsListContent">
                            <div class="loading">–ó–∞–≥—Ä—É–∑–∫–∞ –æ–±—ä–µ–∫—Ç–æ–≤...</div>
                        </div>
                    </div>
                </div>
            </div>
        </div>

        <div class="map-container">
            <div id="map"></div>
        </div>
    </div>

    <script type="text/javascript">
        // üî• –ö–û–ù–§–ò–ì–£–†–ê–¶–ò–Ø
        const SCRIPT_URL = 'https://script.google.com/macros/s/AKfycbzBLM6DSadIf7CxLSjz0PjSQlYMd61JN931-Mor9AfkLLxnARmq-tZtHGxPXiYe4EJk/exec';
        
        // üî• –ö–õ–Æ–ß–ò –î–õ–Ø LOCALSTORAGE
const SESSION_KEY = 'map_session';
const REMEMBER_ME_KEY = 'remember_password';
const SAVED_PASSWORDS_KEY = 'saved_passwords';
const WORK_DAY_STATUS_KEY = 'work_day_status';
const WORK_DAY_START_TIME_KEY = 'work_day_start_time';
const INSPECTORS_CACHE_KEY = 'inspectors_cache';
const INSPECTORS_CACHE_TIMESTAMP = 'inspectors_cache_timestamp';
const FILTERS_STATE_KEY = 'filters_state'; // <-- –≠–¢–û –ù–û–í–´–ô –ö–õ–Æ–ß

        // üî• –ù–ê–°–¢–†–û–ô–ö–ò –°–ï–°–°–ò–ò
        const SESSION_TIMEOUT = 24 * 60 * 60 * 1000; // 24 —á–∞—Å–∞

        // üî• –ì–õ–û–ë–ê–õ–¨–ù–´–ï –ü–ï–†–ï–ú–ï–ù–ù–´–ï
let currentUser = null;
let userAccessRights = '–ò–Ω—Å–ø–µ–∫—Ç–æ—Ä';
let objectsData = [];
let map, objectManager, activeObjectsLayer, inspectorsHomesLayer;
let showInspectorsHomes = false;
let isWorkDayOpen = false;
let availableIcons = {};
let availableColors = [];
let filterAccessSettings = {};
let activeMenu = null;
let isSidebarCollapsed = false;

// üî• –°–û–•–†–ê–ù–ï–ù–ò–ï –°–û–°–¢–û–Ø–ù–ò–Ø –§–ò–õ–¨–¢–†–û–í
function saveFilterState() {
    try {
        const filterState = {
            inspectors: getSelectedInspectors(),
            lists: getSelectedLists(),
            showHidden: document.getElementById('showHidden').checked,
            timestamp: Date.now()
        };
        localStorage.setItem(FILTERS_STATE_KEY, JSON.stringify(filterState));
        console.log('‚úÖ –°–æ—Å—Ç–æ—è–Ω–∏–µ —Ñ–∏–ª—å—Ç—Ä–æ–≤ —Å–æ—Ö—Ä–∞–Ω–µ–Ω–æ');
    } catch (error) {
        console.error('‚ùå –û—à–∏–±–∫–∞ —Å–æ—Ö—Ä–∞–Ω–µ–Ω–∏—è —Ñ–∏–ª—å—Ç—Ä–æ–≤:', error);
    }
}

// üî• –ó–ê–ì–†–£–ó–ö–ê –°–û–°–¢–û–Ø–ù–ò–Ø –§–ò–õ–¨–¢–†–û–í
function loadFilterState() {
    try {
        const saved = localStorage.getItem(FILTERS_STATE_KEY);
        if (saved) {
            const filterState = JSON.parse(saved);
            
            // üî• –í–û–°–°–¢–ê–ù–ê–í–õ–ò–í–ê–ï–ú –ò–ù–°–ü–ï–ö–¢–û–†–û–í
            const inspectorCheckboxes = document.querySelectorAll('#inspectorsList input[type="checkbox"]');
            inspectorCheckboxes.forEach(checkbox => {
                const inspector = checkbox.id.replace('insp_', '');
                checkbox.checked = filterState.inspectors.includes(inspector);
            });
            
            // üî• –í–û–°–°–¢–ê–ù–ê–í–õ–ò–í–ê–ï–ú –°–ü–ò–°–ö–ò
            const listCheckboxes = document.querySelectorAll('#listsList input[type="checkbox"]');
            listCheckboxes.forEach(checkbox => {
                const list = checkbox.id.replace('list_', '');
                checkbox.checked = filterState.lists.includes(list);
            });
            
            // üî• –í–û–°–°–¢–ê–ù–ê–í–õ–ò–í–ê–ï–ú –ß–ï–ö–ë–û–ö–° "–ú–û–ù–ò–¢–û–†–ò–ù–ì"
            document.getElementById('showHidden').checked = filterState.showHidden;
            
            console.log('‚úÖ –°–æ—Å—Ç–æ—è–Ω–∏–µ —Ñ–∏–ª—å—Ç—Ä–æ–≤ –≤–æ—Å—Å—Ç–∞–Ω–æ–≤–ª–µ–Ω–æ');
            return true;
        }
    } catch (error) {
        console.error('‚ùå –û—à–∏–±–∫–∞ –∑–∞–≥—Ä—É–∑–∫–∏ —Ñ–∏–ª—å—Ç—Ä–æ–≤:', error);
    }
    return false;
}

// üî• –°–ë–†–û–° –§–ò–õ–¨–¢–†–û–í –ö –°–û–°–¢–û–Ø–ù–ò–Æ "–ü–û –£–ú–û–õ–ß–ê–ù–ò–Æ"
function resetFiltersToDefault() {
    // üî• –í–´–ë–ò–†–ê–ï–ú –í–°–ï–• –ò–ù–°–ü–ï–ö–¢–û–†–û–í (–∫—Ä–æ–º–µ –Ω–µ–∞–∫—Ç–∏–≤–Ω—ã—Ö)
    const inspectorCheckboxes = document.querySelectorAll('#inspectorsList input[type="checkbox"]');
    inspectorCheckboxes.forEach(checkbox => {
        const inspector = checkbox.id.replace('insp_', '');
        const style = getInspectorStyle(inspector);
        checkbox.checked = style.status === 'active'; // —Ç–æ–ª—å–∫–æ –∞–∫—Ç–∏–≤–Ω—ã—Ö
    });
    
    // üî• –í–´–ë–ò–†–ê–ï–ú –í–°–ï –°–ü–ò–°–ö–ò
    const listCheckboxes = document.querySelectorAll('#listsList input[type="checkbox"]');
    listCheckboxes.forEach(checkbox => {
        checkbox.checked = true;
    });
    
    // üî• –°–ë–†–ê–°–´–í–ê–ï–ú –ß–ï–ö–ë–û–ö–° "–ú–û–ù–ò–¢–û–†–ò–ù–ì"
    document.getElementById('showHidden').checked = false;
    
    console.log('‚úÖ –§–∏–ª—å—Ç—Ä—ã —Å–±—Ä–æ—à–µ–Ω—ã –∫ —Å–æ—Å—Ç–æ—è–Ω–∏—é –ø–æ —É–º–æ–ª—á–∞–Ω–∏—é');
    saveFilterState();
    updateFilters();
}

        // üî• –ò–ù–ò–¶–ò–ê–õ–ò–ó–ê–¶–ò–Ø –ü–†–ò –ó–ê–ì–†–£–ó–ö–ï
        document.addEventListener('DOMContentLoaded', function() {
            console.log('üü° –°—Ç—Ä–∞–Ω–∏—Ü–∞ –∑–∞–≥—Ä—É–∂–µ–Ω–∞, –ø—Ä–æ–≤–µ—Ä—è–µ–º —Å–µ—Å—Å–∏—é...');
            
            // –í—Å–µ–≥–¥–∞ –∑–∞–≥—Ä—É–∂–∞–µ–º —Å–≤–µ–∂–∏—Ö –∏–Ω—Å–ø–µ–∫—Ç–æ—Ä–æ–≤
            loadInspectorsFromServer();
            
            // –ü—ã—Ç–∞–µ–º—Å—è –≤–æ—Å—Å—Ç–∞–Ω–æ–≤–∏—Ç—å —Å–µ—Å—Å–∏—é
            if (restoreSession()) {
                console.log('‚úÖ –°–µ—Å—Å–∏—è –≤–æ—Å—Å—Ç–∞–Ω–æ–≤–ª–µ–Ω–∞');
            }
            
            // –ò–Ω–∏—Ü–∏–∞–ª–∏–∑–∏—Ä—É–µ–º –∫–∞—Ä—Ç—É
            ymaps.ready(initMap);
            
            // –û–±—Ä–∞–±–æ—Ç—á–∏–∫ –∫–ª–∏–∫–∞ –ø–æ –∫–∞—Ä—Ç–µ –¥–ª—è —Å–∫—Ä—ã—Ç–∏—è –º–æ–±–∏–ª—å–Ω–æ–≥–æ —Å–∞–π–¥–±–∞—Ä–∞
            document.getElementById('map').addEventListener('click', function() {
                if (checkMobileDevice() && document.getElementById('sidebar').classList.contains('mobile-open')) {
                    toggleMobileSidebar();
                }
            });
        });

        // üî• –ü–†–û–í–ï–†–ö–ê –ú–û–ë–ò–õ–¨–ù–û–ì–û –£–°–¢–†–û–ô–°–¢–í–ê
        function checkMobileDevice() {
            return window.innerWidth <= 768;
        }

        // üî• –ü–ï–†–ï–ö–õ–Æ–ß–ï–ù–ò–ï –°–ê–ô–î–ë–ê–†–ê (–î–ï–°–ö–¢–û–ü)
        function toggleSidebar() {
            const sidebar = document.getElementById('sidebar');
            const toggleBtn = document.getElementById('sidebarToggle');
            
            isSidebarCollapsed = !isSidebarCollapsed;
            
            if (isSidebarCollapsed) {
                sidebar.classList.add('collapsed');
                toggleBtn.innerHTML = '‚ñ∂';
            } else {
                sidebar.classList.remove('collapsed');
                toggleBtn.innerHTML = '‚óÄ';
            }
        }

        // üî• –ü–ï–†–ï–ö–õ–Æ–ß–ï–ù–ò–ï –ú–û–ë–ò–õ–¨–ù–û–ì–û –°–ê–ô–î–ë–ê–†–ê
        function toggleMobileSidebar() {
            const sidebar = document.getElementById('sidebar');
            const toggleBtn = document.getElementById('mobileToggleBtn');
            
            if (sidebar.classList.contains('mobile-open')) {
                sidebar.classList.remove('mobile-open');
                toggleBtn.textContent = 'üì± –ü–∞–Ω–µ–ª—å';
            } else {
                sidebar.classList.add('mobile-open');
                toggleBtn.textContent = '‚úï –ó–∞–∫—Ä—ã—Ç—å';
            }
        }

        // üî• –°–ò–°–¢–ï–ú–ê –°–ï–°–°–ò–ô –ò –ê–£–¢–ï–ù–¢–ò–§–ò–ö–ê–¶–ò–ò
        function saveSession() {
            if (currentUser) {
                const sessionData = {
                    user: currentUser,
                    role: userAccessRights,
                    timestamp: Date.now()
                };
                localStorage.setItem(SESSION_KEY, JSON.stringify(sessionData));
                console.log('‚úÖ –°–µ—Å—Å–∏—è —Å–æ—Ö—Ä–∞–Ω–µ–Ω–∞');
            }
        }

        function restoreSession() {
            try {
                const sessionData = localStorage.getItem(SESSION_KEY);
                if (sessionData) {
                    const session = JSON.parse(sessionData);
                    const sessionAge = Date.now() - session.timestamp;
                    
                    if (sessionAge < SESSION_TIMEOUT) {
                        console.log('üîÑ –í–æ—Å—Å—Ç–∞–Ω–∞–≤–ª–∏–≤–∞–µ–º —Å–µ—Å—Å–∏—é –¥–ª—è:', session.user);
                        
                        currentUser = session.user;
                        userAccessRights = session.role;
                        
                        // –í–æ—Å—Å—Ç–∞–Ω–∞–≤–ª–∏–≤–∞–µ–º —Å—Ç–∞—Ç—É—Å —Ä–∞–±–æ—á–µ–≥–æ –¥–Ω—è –û–¢–î–ï–õ–¨–ù–û –æ—Ç —Å–µ—Å—Å–∏–∏
                        const workDayStatus = getWorkDayStatus();
                        isWorkDayOpen = workDayStatus.isOpen;
                        
                        showMainInterface();
                        loadData();
                        return true;
                    } else {
                        console.log('‚ùå –°–µ—Å—Å–∏—è –∏—Å—Ç–µ–∫–ª–∞');
                        clearSession();
                    }
                }
            } catch (error) {
                console.error('‚ùå –û—à–∏–±–∫–∞ –≤–æ—Å—Å—Ç–∞–Ω–æ–≤–ª–µ–Ω–∏—è —Å–µ—Å—Å–∏–∏:', error);
                clearSession();
            }
            return false;
        }

        function clearSession() {
            localStorage.removeItem(SESSION_KEY);
            currentUser = null;
            userAccessRights = '–ò–Ω—Å–ø–µ–∫—Ç–æ—Ä';
        }

        // üî• –°–ò–°–¢–ï–ú–ê "–ó–ê–ü–û–ú–ù–ò–¢–¨ –ü–ê–†–û–õ–¨"
        function savePassword(username, password) {
            try {
                const rememberMe = document.getElementById('rememberPassword').checked;
                
                if (rememberMe && username && password) {
                    localStorage.setItem(REMEMBER_ME_KEY, 'true');
                    
                    const savedPasswords = getSavedPasswords();
                    savedPasswords[username] = password;
                    localStorage.setItem(SAVED_PASSWORDS_KEY, JSON.stringify(savedPasswords));
                    
                    console.log('‚úÖ –ü–∞—Ä–æ–ª—å —Å–æ—Ö—Ä–∞–Ω–µ–Ω –¥–ª—è:', username);
                } else {
                    clearSavedPassword(username);
                }
            } catch (error) {
                console.error('‚ùå –û—à–∏–±–∫–∞ —Å–æ—Ö—Ä–∞–Ω–µ–Ω–∏—è –ø–∞—Ä–æ–ª—è:', error);
            }
        }

        function getSavedPasswords() {
            try {
                const saved = localStorage.getItem(SAVED_PASSWORDS_KEY);
                return saved ? JSON.parse(saved) : {};
            } catch (error) {
                return {};
            }
        }

        function getSavedPassword(username) {
            try {
                const savedPasswords = getSavedPasswords();
                return savedPasswords[username] || null;
            } catch (error) {
                return null;
            }
        }

        function clearSavedPassword(username) {
            try {
                const savedPasswords = getSavedPasswords();
                if (savedPasswords[username]) {
                    delete savedPasswords[username];
                    localStorage.setItem(SAVED_PASSWORDS_KEY, JSON.stringify(savedPasswords));
                }
            } catch (error) {
                console.error('‚ùå –û—à–∏–±–∫–∞ —É–¥–∞–ª–µ–Ω–∏—è –ø–∞—Ä–æ–ª—è:', error);
            }
        }

        function autoFillLoginForm() {
            const userSelect = document.getElementById('userSelect');
            const passwordInput = document.getElementById('passwordInput');
            const rememberCheckbox = document.getElementById('rememberPassword');
            
            if (userSelect.value) {
                const savedPassword = getSavedPassword(userSelect.value);
                if (savedPassword) {
                    passwordInput.value = savedPassword;
                    rememberCheckbox.checked = true;
                } else {
                    passwordInput.value = '';
                    rememberCheckbox.checked = localStorage.getItem(REMEMBER_ME_KEY) === 'true';
                }
            }
        }

        // üî• –°–ò–°–¢–ï–ú–ê –†–ê–ë–û–ß–ï–ì–û –î–ù–Ø
        function saveWorkDayStatus(isOpen, startTime = null) {
            try {
                localStorage.setItem(WORK_DAY_STATUS_KEY, isOpen ? 'open' : 'closed');
                if (startTime) {
                    localStorage.setItem(WORK_DAY_START_TIME_KEY, startTime);
                }
                console.log('‚úÖ –°—Ç–∞—Ç—É—Å —Ä–∞–±–æ—á–µ–≥–æ –¥–Ω—è —Å–æ—Ö—Ä–∞–Ω–µ–Ω:', isOpen ? '–æ—Ç–∫—Ä—ã—Ç' : '–∑–∞–∫—Ä—ã—Ç');
            } catch (error) {
                console.error('‚ùå –û—à–∏–±–∫–∞ —Å–æ—Ö—Ä–∞–Ω–µ–Ω–∏—è —Å—Ç–∞—Ç—É—Å–∞ —Ä–∞–±–æ—á–µ–≥–æ –¥–Ω—è:', error);
            }
        }

        function getWorkDayStatus() {
            try {
                const status = localStorage.getItem(WORK_DAY_STATUS_KEY);
                const startTime = localStorage.getItem(WORK_DAY_START_TIME_KEY);
                
                return {
                    isOpen: status === 'open',
                    startTime: startTime
                };
            } catch (error) {
                return { isOpen: false, startTime: null };
            }
        }

        function clearWorkDayStatus() {
            try {
                localStorage.removeItem(WORK_DAY_STATUS_KEY);
                localStorage.removeItem(WORK_DAY_START_TIME_KEY);
            } catch (error) {
                console.error('‚ùå –û—à–∏–±–∫–∞ –æ—á–∏—Å—Ç–∫–∏ —Å—Ç–∞—Ç—É—Å–∞ —Ä–∞–±–æ—á–µ–≥–æ –¥–Ω—è:', error);
            }
        }

        // üî• –ó–ê–ì–†–£–ó–ö–ê –ò–ù–°–ü–ï–ö–¢–û–†–û–í - –ë–ï–ó –ö–≠–®–ê
        function loadInspectorsFromServer() {
            const callbackName = 'inspectorsLoginCallback_' + Date.now();
            window[callbackName] = function(data) {
                delete window[callbackName];
                
                if (data.success && data.inspectorsData) {
                    updateUserSelect(data.inspectorsData);
                    console.log('‚úÖ –ò–Ω—Å–ø–µ–∫—Ç–æ—Ä—ã –∑–∞–≥—Ä—É–∂–µ–Ω—ã –º–≥–Ω–æ–≤–µ–Ω–Ω–æ:', Object.keys(data.inspectorsData).length);
                } else {
                    console.error('‚ùå –û—à–∏–±–∫–∞ –∑–∞–≥—Ä—É–∑–∫–∏ –∏–Ω—Å–ø–µ–∫—Ç–æ—Ä–æ–≤');
                // –ü–æ–∫–∞–∑—ã–≤–∞–µ–º –±–∞–∑–æ–≤—ã—Ö –∏–Ω—Å–ø–µ–∫—Ç–æ—Ä–æ–≤ –ø—Ä–∏ –æ—à–∏–±–∫–µ
                    const userSelect = document.getElementById('userSelect');
                    userSelect.innerHTML = '<option value="">-- –û—à–∏–±–∫–∞ –∑–∞–≥—Ä—É–∑–∫–∏ --</option>';
                }
            };
            
            const url = SCRIPT_URL + '?action=getData&callback=' + callbackName;
            const script = document.createElement('script');
            script.src = url;
            script.onerror = function() {
                delete window[callbackName];
                console.error('‚ùå –û—à–∏–±–∫–∞ –∑–∞–≥—Ä—É–∑–∫–∏ –∏–Ω—Å–ø–µ–∫—Ç–æ—Ä–æ–≤');
                const userSelect = document.getElementById('userSelect');
                userSelect.innerHTML = '<option value="">-- –û—à–∏–±–∫–∞ —Å–µ—Ç–∏ --</option>';
            };
            document.head.appendChild(script);
        }

        function refreshInspectorsList() {
            loadInspectorsFromServer();
            showNotification('üîÑ –û–±–Ω–æ–≤–ª—è–µ–º —Å–ø–∏—Å–æ–∫ –∏–Ω—Å–ø–µ–∫—Ç–æ—Ä–æ–≤...', 'success');
        }

        function updateUserSelect(inspectorsData) {
            const userSelect = document.getElementById('userSelect');
            userSelect.innerHTML = '<option value="">-- –í—ã–±–µ—Ä–∏—Ç–µ –∏–Ω—Å–ø–µ–∫—Ç–æ—Ä–∞ --</option>';
            
            Object.keys(inspectorsData).forEach(inspector => {
                const option = document.createElement('option');
                option.value = inspector;
                option.textContent = inspector;
                userSelect.appendChild(option);
            });
            
            // –î–æ–±–∞–≤–ª—è–µ–º –æ–±—Ä–∞–±–æ—Ç—á–∏–∫ –¥–ª—è –∞–≤—Ç–æ–∑–∞–ø–æ–ª–Ω–µ–Ω–∏—è –ø–∞—Ä–æ–ª—è
            userSelect.addEventListener('change', autoFillLoginForm);
            
            console.log('‚úÖ –û–±–Ω–æ–≤–ª–µ–Ω —Å–ø–∏—Å–æ–∫ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª–µ–π:', Object.keys(inspectorsData).length);
        }

        // üî• –û–°–ù–û–í–ù–´–ï –§–£–ù–ö–¶–ò–ò –ò–ù–¢–ï–†–§–ï–ô–°–ê
        function showMainInterface() {
            document.getElementById('loginOverlay').style.display = 'none';
            document.getElementById('mainContainer').style.display = 'flex';
            document.getElementById('userInfo').style.display = 'flex';
            document.getElementById('currentUser').textContent = currentUser + ' (' + userAccessRights + ')';
            
            // üî• –ü–û–ö–ê–ó–´–í–ê–ï–ú –°–û–û–¢–í–ï–¢–°–¢–í–£–Æ–©–ò–ï –°–ï–ö–¶–ò–ò –£–ü–†–ê–í–õ–ï–ù–ò–Ø
            if (userAccessRights === '–ò–º–ø–µ—Ä–∞—Ç–æ—Ä' || userAccessRights === '–ê–¥–º–∏–Ω–∏—Å—Ç—Ä–∞—Ç–æ—Ä') {
                document.getElementById('adminSection').style.display = 'block';
            } else {
                document.getElementById('workDaySection').style.display = 'block';
                updateWorkDayButtons();
                checkWorkDayStatus();
            }
            
            // üî• –°–ö–†–´–í–ê–ï–ú –ö–ù–û–ü–ö–£ –ú–û–ë–ò–õ–¨–ù–û–ô –ü–ê–ù–ï–õ–ò –ù–ê –î–ï–°–ö–¢–û–ü–ï
            if (!checkMobileDevice()) {
                document.getElementById('mobileToggleBtn').style.display = 'none';
            }
        }

        function login() {
            const userSelect = document.getElementById('userSelect');
            const passwordInput = document.getElementById('passwordInput');
            const selectedUser = userSelect.value;
            const enteredPassword = passwordInput.value;

            if (!selectedUser) {
                alert('–ü–æ–∂–∞–ª—É–π—Å—Ç–∞, –≤—ã–±–µ—Ä–∏—Ç–µ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è');
                return;
            }

            if (!enteredPassword) {
                alert('–ü–æ–∂–∞–ª—É–π—Å—Ç–∞, –≤–≤–µ–¥–∏—Ç–µ –ø–∞—Ä–æ–ª—å');
                return;
            }

            console.log('üü° –ü—Ä–æ–≤–µ—Ä–∫–∞ –ø–∞—Ä–æ–ª—è –¥–ª—è:', selectedUser);
            
            const callbackName = 'verifyPasswordCallback_' + Date.now();
            window[callbackName] = function(result) {
                console.log('üü° –û—Ç–≤–µ—Ç –æ—Ç —Å–µ—Ä–≤–µ—Ä–∞:', result);
                delete window[callbackName];
                
                if (result.success && result.verified) {
                    console.log('‚úÖ –£–°–ü–ï–®–ù–´–ô –õ–û–ì–ò–ù!');
                    currentUser = selectedUser;
                    userAccessRights = result.user.role;
                    
                    // –°–æ—Ö—Ä–∞–Ω—è–µ–º –ø–∞—Ä–æ–ª—å –µ—Å–ª–∏ –≤–∫–ª—é—á–µ–Ω–æ "–ó–∞–ø–æ–º–Ω–∏—Ç—å"
                    savePassword(selectedUser, enteredPassword);
                    
                    // –°–æ—Ö—Ä–∞–Ω—è–µ–º —Å–µ—Å—Å–∏—é
                    saveSession();
                    
                    showMainInterface();
                    loadData();
                    showNotification(`‚úÖ –î–æ–±—Ä–æ –ø–æ–∂–∞–ª–æ–≤–∞—Ç—å, ${currentUser} (${userAccessRights})`, 'success');
                } else {
                    console.log('‚ùå –û–®–ò–ë–ö–ê –õ–û–ì–ò–ù–ê');
                    alert('–ù–µ–≤–µ—Ä–Ω—ã–π –ø–∞—Ä–æ–ª—å! ' + (result.message || ''));
                    passwordInput.value = '';
                    passwordInput.focus();
                }
            };
            
            const url = SCRIPT_URL + '?action=verifyPassword&inspector=' + encodeURIComponent(selectedUser) + '&password=' + encodeURIComponent(enteredPassword.trim()) + '&callback=' + callbackName;
            const script = document.createElement('script');
            script.src = url;
            script.onerror = function() {
                delete window[callbackName];
                alert('–û—à–∏–±–∫–∞ —Å–æ–µ–¥–∏–Ω–µ–Ω–∏—è —Å —Å–µ—Ä–≤–µ—Ä–æ–º');
            };
            document.head.appendChild(script);
        }

        function logout() {
            clearSession();
            document.getElementById('loginOverlay').style.display = 'flex';
            document.getElementById('mainContainer').style.display = 'none';
            document.getElementById('userInfo').style.display = 'none';
            document.getElementById('adminSection').style.display = 'none';
            document.getElementById('workDaySection').style.display = 'none';
            document.getElementById('passwordInput').value = '';
            showInspectorsHomes = false;
            if (inspectorsHomesLayer) inspectorsHomesLayer.removeAll();
            closeAllMenus();
        }

        // üî• –ö–ê–†–¢–ê –ò –î–ê–ù–ù–´–ï
        function initMap() {
            console.log('üü° Yandex Maps ready');
            map = new ymaps.Map("map", {
                center: [55.7558, 37.6173],
                zoom: 10
            });

            objectManager = new ymaps.ObjectManager({
                clusterize: false,
                gridSize: 64
            });

            activeObjectsLayer = new ymaps.ObjectManager({
                clusterize: false,
                gridSize: 64
            });

            inspectorsHomesLayer = new ymaps.ObjectManager({
                clusterize: false,
                gridSize: 64
            });

            // üî• –£–°–¢–ê–ù–ê–í–õ–ò–í–ê–ï–ú –ù–ê–°–¢–†–û–ô–ö–ò –ë–ê–õ–õ–£–ù–û–í
            objectManager.objects.options.set({
                balloonMaxWidth: 300,
                balloonMinWidth: 250,
                balloonPanelMaxMapArea: 0
            });
            
            activeObjectsLayer.objects.options.set({
                balloonMaxWidth: 300,
                balloonMinWidth: 250,
                balloonPanelMaxMapArea: 0
            });

            objectManager.objects.events.add('click', function (e) {
                const objectId = e.get('objectId');
                showObjectBalloon(objectId);
            });

            activeObjectsLayer.objects.events.add('click', function (e) {
                const objectId = e.get('objectId');
                showObjectBalloon(objectId);
            });

            map.geoObjects.add(objectManager);
            map.geoObjects.add(activeObjectsLayer);
            map.geoObjects.add(inspectorsHomesLayer);
            
            // üî• –û–ë–†–ê–ë–û–¢–ß–ò–ö–ò –ò–ó–ú–ï–ù–ï–ù–ò–Ø –ú–ê–°–®–¢–ê–ë–ê –î–õ–Ø –ê–î–ê–ü–¢–ê–¶–ò–ò –ë–ê–õ–õ–£–ù–û–í
            map.events.add('boundschange', function() {
                const zoom = map.getZoom();
                updateBalloonSize(zoom);
            });
        }

        // üî• –§–£–ù–ö–¶–ò–Ø –ê–î–ê–ü–¢–ê–¶–ò–ò –†–ê–ó–ú–ï–†–ê –ë–ê–õ–õ–£–ù–û–í –ü–û–î –ú–ê–°–®–¢–ê–ë
        function updateBalloonSize(zoom) {
            let balloonWidth = 300;
            let balloonMinWidth = 250;
            
            if (zoom > 15) {
                balloonWidth = 280;
                balloonMinWidth = 230;
            } else if (zoom < 10) {
                balloonWidth = 320;
                balloonMinWidth = 270;
            }
            
            objectManager.objects.options.set({
                balloonMaxWidth: balloonWidth,
                balloonMinWidth: balloonMinWidth
            });
            
            activeObjectsLayer.objects.options.set({
                balloonMaxWidth: balloonWidth,
                balloonMinWidth: balloonMinWidth
            });
        }

        function loadData() {
            if (!currentUser) return;
            
            console.log('üü° –ó–∞–≥—Ä—É–∑–∫–∞ –¥–∞–Ω–Ω—ã—Ö —Å —Å–µ—Ä–≤–µ—Ä–∞...');
            showLoading('–ó–∞–≥—Ä—É–∑–∫–∞ –¥–∞–Ω–Ω—ã—Ö –∏–∑ Google –¢–∞–±–ª–∏—Ü—ã...');
            
            const callbackName = 'jsonpCallback_' + Date.now();
            window[callbackName] = function(data) {
                console.log('üü° –ü–æ–ª—É—á–µ–Ω—ã –¥–∞–Ω–Ω—ã–µ –æ—Ç —Å–µ—Ä–≤–µ—Ä–∞:', data);
                delete window[callbackName];
                
                if (data.success && data.points) {
                    processServerData(data);
                    showNotification(`‚úÖ –ó–∞–≥—Ä—É–∂–µ–Ω–æ ${data.points.length} –æ–±—ä–µ–∫—Ç–æ–≤`, 'success');
                } else {
                    console.error('‚ùå –û—à–∏–±–∫–∞ –∑–∞–≥—Ä—É–∑–∫–∏:', data);
                    showError('–û—à–∏–±–∫–∞ –∑–∞–≥—Ä—É–∑–∫–∏: ' + (data.error || '–ù–µ–∏–∑–≤–µ—Å—Ç–Ω–∞—è –æ—à–∏–±–∫–∞'));
                }
            };
            
            const url = SCRIPT_URL + '?action=getData&callback=' + callbackName;
            
            console.log('üü° –ó–∞–ø—Ä–æ—Å –∫ URL:', url);
            const script = document.createElement('script');
            script.src = url;
            
            script.onerror = function() {
                console.error('‚ùå –û—à–∏–±–∫–∞ –∑–∞–≥—Ä—É–∑–∫–∏ —Å–∫—Ä–∏–ø—Ç–∞');
                delete window[callbackName];
                showError('–û—à–∏–±–∫–∞ –∑–∞–≥—Ä—É–∑–∫–∏ –¥–∞–Ω–Ω—ã—Ö. –ü—Ä–æ–≤–µ—Ä—å—Ç–µ –ø–æ–¥–∫–ª—é—á–µ–Ω–∏–µ –∫ –∏–Ω—Ç–µ—Ä–Ω–µ—Ç—É.');
            };
            
            document.head.appendChild(script);
        }

       function processServerData(data) {
    // üî• –í–û–ó–í–†–ê–©–ê–ï–ú –û–†–ò–ì–ò–ù–ê–õ–¨–ù–´–ï ID (–±–µ–∑ –ø—Ä–µ–æ–±—Ä–∞–∑–æ–≤–∞–Ω–∏—è –≤ —Å—Ç—Ä–æ–∫–∏!)
    objectsData = data.points;
    
    window.INSPECTORS_CONFIG = data.inspectorsConfig || {};
    window.INSPECTOR_HOMES = data.inspectorsHomes || {};
    availableIcons = data.availableIcons || {};
    availableColors = data.availableColors || [];
    filterAccessSettings = data.filterAccessSettings || {};
    
    console.log('‚úÖ –ó–∞–≥—Ä—É–∂–µ–Ω–æ –æ–±—ä–µ–∫—Ç–æ–≤:', objectsData.length);
    console.log('‚úÖ –ö–æ–Ω—Ñ–∏–≥—É—Ä–∞—Ü–∏—è –∏–Ω—Å–ø–µ–∫—Ç–æ—Ä–æ–≤:', Object.keys(window.INSPECTORS_CONFIG).length);
    
    initInterface();
    updateMap();
    updateObjectsList();
}

        function forceRefreshData() {
            loadData();
        }

        // üî• –§–£–ù–ö–¶–ò–Ø –î–õ–Ø –°–ß–ï–¢–ß–ò–ö–û–í –°–ü–ò–°–ö–û–í
        function calculateListStats() {
    const stats = {};
    const selectedInspectors = getSelectedInspectors(); // üî• –ü–æ–ª—É—á–∞–µ–º –≤—ã–±—Ä–∞–Ω–Ω—ã—Ö –∏–Ω—Å–ø–µ–∫—Ç–æ—Ä–æ–≤
    
    objectsData.forEach(obj => {
        // üî• –£–ß–ò–¢–´–í–ê–ï–ú –¢–û–õ–¨–ö–û –û–ë–™–ï–ö–¢–´ –í–´–ë–†–ê–ù–ù–´–• –ò–ù–°–ü–ï–ö–¢–û–†–û–í
        if (selectedInspectors.length > 0 && !selectedInspectors.includes(obj.inspector)) {
            return; // –ü—Ä–æ–ø—É—Å–∫–∞–µ–º –æ–±—ä–µ–∫—Ç—ã –Ω–µ–≤—ã–±—Ä–∞–Ω–Ω—ã—Ö –∏–Ω—Å–ø–µ–∫—Ç–æ—Ä–æ–≤
        }
        
        if (!stats[obj.list]) {
            stats[obj.list] = {
                total: 0,
                completed: 0,
                active: 0
            };
        }
        
        stats[obj.list].total++;
        
        if (obj.exitTime && obj.exitTime !== '') {
            stats[obj.list].completed++;
        }
        if (obj.entryTime && !obj.exitTime) {
            stats[obj.list].active++;
        }
    });
    
    return stats;
}

        function initInterface() {
    console.log('üü° ========== –ù–ê–ß–ê–õ–û –ò–ù–ò–¶–ò–ê–õ–ò–ó–ê–¶–ò–ò –ò–ù–¢–ï–†–§–ï–ô–°–ê ==========');
    
    const uniqueLists = [...new Set(objectsData.map(obj => obj.list).filter(Boolean))].sort();
    const inspectorStats = calculateInspectorStats();
    const listStats = calculateListStats();

    const inspectorsList = document.getElementById('inspectorsList');
    inspectorsList.innerHTML = '';
    
    // üî• –í–ö–õ–Æ–ß–ê–ï–ú ADMIN –¢–û–õ–¨–ö–û –î–õ–Ø –ò–ú–ü–ï–†–ê–¢–û–†–ê
    let allSystemInspectors = Object.keys(window.INSPECTORS_CONFIG || {}).filter(inspector => 
        inspector !== '–Æ—Å—É–ø–æ–≤ –ê—Ä—Ç—É—Ä –†—É—Å–ª–∞–Ω–æ–≤–∏—á'
    );

    // üî• –ï–°–õ–ò –ü–û–õ–¨–ó–û–í–ê–¢–ï–õ–¨ –ù–ï –ò–ú–ü–ï–†–ê–¢–û–† - –ò–°–ö–õ–Æ–ß–ê–ï–ú ADMIN –ò–ó –§–ò–õ–¨–¢–†–û–í
    if (userAccessRights !== '–ò–º–ø–µ—Ä–∞—Ç–æ—Ä') {
        allSystemInspectors = allSystemInspectors.filter(inspector => inspector !== 'Admin');
    }
    
    allSystemInspectors.forEach(inspector => {
        const style = getInspectorStyle(inspector);
        const stats = inspectorStats[inspector] || { total: 0, completed: 0, active: 0 };
        
        const hasAccessToObjects = userAccessRights === '–ò–º–ø–µ—Ä–∞—Ç–æ—Ä' || 
                                 userAccessRights === '–ê–¥–º–∏–Ω–∏—Å—Ç—Ä–∞—Ç–æ—Ä' ||
                                 isSameInspector(inspector, currentUser) ||
                                 hasFilterAccessToInspector(inspector);
        
        if (hasAccessToObjects) {
            const checkbox = document.createElement('div');
            checkbox.className = 'checkbox-item';
            
            checkbox.innerHTML = `
                <input type="checkbox" id="insp_${inspector}" onchange="onInspectorChange()" 
                       ${isSameInspector(inspector, currentUser) ? 'checked' : ''}>
                <span class="inspector-icon">${style.icon}</span>
                <span class="color-dot" style="background-color: ${style.color}"></span>
                <label for="insp_${inspector}">
                    ${inspector}
                </label>
                <span class="inspector-counter ${inspector === 'Admin' ? 'admin' : ''} 
                      ${style.status !== 'active' ? 'inactive' : ''}">
                    ${stats.completed}/${stats.total}
                </span>
            `;
            inspectorsList.appendChild(checkbox);
        }
    });

    const listsList = document.getElementById('listsList');
    listsList.innerHTML = '';
    
    uniqueLists.forEach(list => {
        const stats = listStats[list] || { total: 0, completed: 0, active: 0 };
        const checkbox = document.createElement('div');
        checkbox.className = 'checkbox-item';
        checkbox.innerHTML = `
            <input type="checkbox" id="list_${list}" onchange="onListChange()" checked>
            <label for="list_${list}">
                ${list} 
                <span class="list-counter">(${stats.completed}/${stats.total})</span>
            </label>
        `;
        listsList.appendChild(checkbox);
    });

     setTimeout(() => {
        updateInspectorCounters();
        
        // üî• –ó–ê–ì–†–£–ó–ö–ê –°–û–•–†–ê–ù–ï–ù–ù–´–• –§–ò–õ–¨–¢–†–û–í –ò–õ–ò –£–°–¢–ê–ù–û–í–ö–ê –ü–û –£–ú–û–õ–ß–ê–ù–ò–Æ
        if (!loadFilterState()) {
            resetFiltersToDefault(); // –µ—Å–ª–∏ –Ω–µ—Ç —Å–æ—Ö—Ä–∞–Ω–µ–Ω–Ω—ã—Ö - —Å—Ç–∞–≤–∏–º –ø–æ —É–º–æ–ª—á–∞–Ω–∏—é
        }
        
        updateFilters();
    }, 100);
        }

        function getInspectorStyle(inspector) {
            if (!inspector) {
                return { 
                    color: '#808080', 
                    icon: 'üë®‚Äçüíº', 
                    status: 'active', 
                    accessRights: '–ò–Ω—Å–ø–µ–∫—Ç–æ—Ä'
                };
            }
            
            const config = window.INSPECTORS_CONFIG ? window.INSPECTORS_CONFIG[inspector] : null;
            if (config) {
                return {
                    color: config.color || '#808080',
                    icon: config.icon || 'üë®‚Äçüíº',
                    status: config.status || 'active',
                    accessRights: config.accessRights || '–ò–Ω—Å–ø–µ–∫—Ç–æ—Ä'
                };
            }
            
            return { 
                color: '#808080', 
                icon: 'üë®‚Äçüíº', 
                status: 'active', 
                accessRights: '–ò–Ω—Å–ø–µ–∫—Ç–æ—Ä'
            };
        }

        function calculateInspectorStats(selectedLists = null) {
            const stats = {};
            
            objectsData.forEach(obj => {
                if (selectedLists && selectedLists.length > 0 && !selectedLists.includes(obj.list)) {
                    return;
                }
                
                if (!stats[obj.inspector]) {
                    stats[obj.inspector] = {
                        total: 0,
                        completed: 0,
                        active: 0
                    };
                }
                
                stats[obj.inspector].total++;
                
                if (obj.exitTime && obj.exitTime !== '') {
                    stats[obj.inspector].completed++;
                }
                if (obj.entryTime && !obj.exitTime) {
                    stats[obj.inspector].active++;
                }
            });
            
            return stats;
        }

        function hasFilterAccessToInspector(targetInspector) {
            if (userAccessRights === '–ò–º–ø–µ—Ä–∞—Ç–æ—Ä' || userAccessRights === '–ê–¥–º–∏–Ω–∏—Å—Ç—Ä–∞—Ç–æ—Ä') {
                return true;
            }
            
            if (isSameInspector(targetInspector, currentUser)) {
                return true;
            }
            
            if (!currentUser || !filterAccessSettings[currentUser]) {
                return false;
            }
            
            const userAccess = filterAccessSettings[currentUser];
            
            if (userAccess === true) {
                return true;
            }
            
            if (Array.isArray(userAccess)) {
                return userAccess.includes(targetInspector);
            }
            
            return false;
        }

        function isSameInspector(objInspector, userInspector) {
            if (!objInspector || !userInspector) return false;
            return objInspector.toLowerCase().trim() === userInspector.toLowerCase().trim();
        }

        function updateInspectorCounters() {
            const selectedLists = getSelectedLists();
            const inspectorStats = calculateInspectorStats(selectedLists.length > 0 ? selectedLists : null);
            
            const inspectorCheckboxes = document.querySelectorAll('#inspectorsList input[type="checkbox"]');
            inspectorCheckboxes.forEach(checkbox => {
                const inspector = checkbox.id.replace('insp_', '');
                const stats = inspectorStats[inspector] || { total: 0, completed: 0, active: 0 };
                const counterElement = checkbox.parentNode.querySelector('.inspector-counter');
                
                if (counterElement) {
                    counterElement.textContent = `${stats.completed}/${stats.total}`;
                    
                    if (stats.total > 0 && stats.completed === stats.total) {
                        counterElement.classList.add('completed');
                    } else {
                        counterElement.classList.remove('completed');
                    }
                }
            });
        }

// üî• –î–û–ë–ê–í–õ–Ø–ï–ú –§–£–ù–ö–¶–ò–Æ –û–ë–ù–û–í–õ–ï–ù–ò–Ø –°–ß–ï–¢–ß–ò–ö–û–í –°–ü–ò–°–ö–û–í
function updateListCounters() {
    const listStats = calculateListStats(); // üî• –¢–µ–ø–µ—Ä—å —É—á–∏—Ç—ã–≤–∞–µ—Ç –≤—ã–±—Ä–∞–Ω–Ω—ã—Ö –∏–Ω—Å–ø–µ–∫—Ç–æ—Ä–æ–≤
    const listCheckboxes = document.querySelectorAll('#listsList input[type="checkbox"]');
    
    listCheckboxes.forEach(checkbox => {
        const list = checkbox.id.replace('list_', '');
        const stats = listStats[list] || { total: 0, completed: 0, active: 0 };
        const counterElement = checkbox.parentNode.querySelector('.list-counter');
        
        if (counterElement) {
            counterElement.textContent = `(${stats.completed}/${stats.total})`;
        }
    });
}



        // üî• –§–ò–õ–¨–¢–†–ê–¶–ò–Ø –ò –ö–ê–†–¢–ê
        function getSelectedInspectors() {
            const selected = [];
            const checkboxes = document.querySelectorAll('#inspectorsList input[type="checkbox"]:checked');
            checkboxes.forEach(checkbox => {
                selected.push(checkbox.id.replace('insp_', ''));
            });
            return selected;
        }

        function getSelectedLists() {
            const selected = [];
            const checkboxes = document.querySelectorAll('#listsList input[type="checkbox"]:checked');
            checkboxes.forEach(checkbox => {
                selected.push(checkbox.id.replace('list_', ''));
            });
            return selected;
        }

        function getFilteredObjects() {
            const selectedInspectors = getSelectedInspectors();
            const selectedLists = getSelectedLists();
            const showHidden = document.getElementById('showHidden').checked;
            const searchText = document.getElementById('searchInput').value.toLowerCase();

            if (userAccessRights === '–ò–º–ø–µ—Ä–∞—Ç–æ—Ä' || userAccessRights === '–ê–¥–º–∏–Ω–∏—Å—Ç—Ä–∞—Ç–æ—Ä') {
                return objectsData.filter(obj => {
                    if (selectedLists.length === 0) return false;
                    if (!selectedLists.includes(obj.list)) return false;
                    if (selectedInspectors.length > 0 && !selectedInspectors.includes(obj.inspector)) return false;
                    
                    if (searchText && 
                        !obj.id.toString().toLowerCase().includes(searchText) &&
                        !obj.address.toLowerCase().includes(searchText)) {
                        return false;
                    }
                    
                    const isCompleted = !!obj.exitTime;
                    if (!showHidden && isCompleted) {
                        return false;
                    }
                    
                    return true;
                });
            }

            return objectsData.filter(obj => {
                if (selectedInspectors.length === 0) return false;
                if (!selectedInspectors.includes(obj.inspector)) return false;
                if (selectedLists.length === 0) return false;
                if (!selectedLists.includes(obj.list)) return false;
                
                const hasAccessToObject = userAccessRights === '–ò–º–ø–µ—Ä–∞—Ç–æ—Ä' || 
                                        userAccessRights === '–ê–¥–º–∏–Ω–∏—Å—Ç—Ä–∞—Ç–æ—Ä' ||
                                        isSameInspector(obj.inspector, currentUser) ||
                                        hasFilterAccessToInspector(obj.inspector);
                
                if (!hasAccessToObject) {
                    return false;
                }
                
                const isCompleted = !!obj.exitTime;
                if (!showHidden && isCompleted) {
                    return false;
                }
                
                return true;
            });
        }

        function updateMap() {
            if (objectsData.length === 0) {
                console.log('‚ùå –ù–µ—Ç –¥–∞–Ω–Ω—ã—Ö –¥–ª—è –æ—Ç–æ–±—Ä–∞–∂–µ–Ω–∏—è –Ω–∞ –∫–∞—Ä—Ç–µ');
                return;
            }

            const filteredObjects = getFilteredObjects();
            console.log('üü° –û–±–Ω–æ–≤–ª–µ–Ω–∏–µ –∫–∞—Ä—Ç—ã —Å', filteredObjects.length, '–æ–±—ä–µ–∫—Ç–∞–º–∏');
            
            objectManager.removeAll();
            activeObjectsLayer.removeAll();

            const newObjects = filteredObjects.filter(obj => {
                const isNew = !obj.entryTime && !obj.exitTime;
                return isNew;
            });

            const activeObjects = filteredObjects.filter(obj => {
                const isActive = obj.entryTime && !obj.exitTime;
                return isActive;
            });

            const completedObjects = filteredObjects.filter(obj => {
                const isCompleted = !!obj.exitTime;
                return isCompleted && document.getElementById('showHidden').checked;
            });

            console.log('üü° –°—Ç–∞—Ç—É—Å—ã –æ–±—ä–µ–∫—Ç–æ–≤ –ø–æ—Å–ª–µ —Ñ–∏–ª—å—Ç—Ä–∞—Ü–∏–∏:', {
                new: newObjects.length,
                active: activeObjects.length,
                completed: completedObjects.length,
                total: filteredObjects.length
            });

            // –ù–æ–≤—ã–µ —Ç–æ—á–∫–∏
            const newFeatures = newObjects.map(obj => {
                const style = getInspectorStyle(obj.inspector);
                const isImperial = obj.inspector === 'Admin' || 
                                 (window.INSPECTORS_CONFIG[obj.inspector] && 
                                  window.INSPECTORS_CONFIG[obj.inspector].accessRights === '–ò–º–ø–µ—Ä–∞—Ç–æ—Ä');
                const markerType = isImperial ? 'islands#blueStarIcon' : 'islands#dotIcon';
                
                return {
                    type: 'Feature',
                    id: obj.id,
                    geometry: {
                        type: 'Point',
                        coordinates: [parseFloat(obj.latitude), parseFloat(obj.longitude)]
                    },
                    properties: {
                        hintContent: `üü° –¢–æ—á–∫–∞ ‚Ññ${obj.id} (${obj.list || '–ë–µ–∑ —Å–ø–∏—Å–∫–∞'})`,
                        balloonContent: getBalloonContent(obj, style.icon),
                        inspector: obj.inspector,
                        list: obj.list,
                        address: obj.address,
                        checklistLink: obj.checklistLink,
                        yandexDiskLink: obj.yandexDiskLink
                    },
                    options: {
                        preset: markerType,
                        iconColor: style.status === 'active' ? style.color : '#808080',
                        iconSize: [30, 30]
                    }
                };
            });

            // –ê–∫—Ç–∏–≤–Ω—ã–µ —Ç–æ—á–∫–∏
            const activeFeatures = activeObjects.map(obj => {
                const style = getInspectorStyle(obj.inspector);

                return {
                    type: 'Feature',
                    id: obj.id,
                    geometry: {
                        type: 'Point',
                        coordinates: [parseFloat(obj.latitude), parseFloat(obj.longitude)]
                    },
                    properties: {
                        hintContent: `üîµ –ê–ö–¢–ò–í–ù–ê –¢–æ—á–∫–∞ ‚Ññ${obj.id} (${obj.list || '–ë–µ–∑ —Å–ø–∏—Å–∫–∞'})`,
                        balloonContent: getBalloonContent(obj, style.icon),
                        inspector: obj.inspector,
                        list: obj.list,
                        address: obj.address,
                        checklistLink: obj.checklistLink,
                        yandexDiskLink: obj.yandexDiskLink
                    },
                    options: {
                        preset: 'islands#circleIcon',
                        iconColor: style.color,
                        iconSize: [50, 50]
                    }
                };
            });

            // –í—ã–ø–æ–ª–Ω–µ–Ω–Ω—ã–µ —Ç–æ—á–∫–∏
            const completedFeatures = completedObjects.map(obj => {
                const style = getInspectorStyle(obj.inspector);

                return {
                    type: 'Feature',
                    id: obj.id,
                    geometry: {
                        type: 'Point',
                        coordinates: [parseFloat(obj.latitude), parseFloat(obj.longitude)]
                    },
                    properties: {
                        hintContent: `‚úÖ –í–´–ü–û–õ–ù–ï–ù–ê –¢–æ—á–∫–∞ ‚Ññ${obj.id} (${obj.list || '–ë–µ–∑ —Å–ø–∏—Å–∫–∞'})`,
                        balloonContent: getBalloonContent(obj, style.icon),
                        inspector: obj.inspector,
                        list: obj.list,
                        address: obj.address,
                        checklistLink: obj.checklistLink,
                        yandexDiskLink: obj.yandexDiskLink
                    },
                    options: {
                        preset: 'islands#blueMedicalIcon',
                        iconColor: style.color,
                        iconSize: [30, 30]
                    }
                };
            });

            if (newFeatures.length > 0 || completedFeatures.length > 0) {
                objectManager.add({
                    type: 'FeatureCollection',
                    features: [...newFeatures, ...completedFeatures]
                });
            }

            if (activeFeatures.length > 0) {
                activeObjectsLayer.add({
                    type: 'FeatureCollection',
                    features: activeFeatures
                });
            }

            updateStats(filteredObjects);
            updateInspectorCounters();
            
            if (document.getElementById('objects-tab').classList.contains('active')) {
                updateObjectsList();
            }
        }

        // üî• –£–õ–£–ß–®–ï–ù–ù–û–ï –¢–û–ß–ï–ß–ù–û–ï –û–ë–ù–û–í–õ–ï–ù–ò–ï –ö–ê–†–¢–´ - –ò–°–ü–†–ê–í–õ–ï–ù–ù–ê–Ø –í–ï–†–°–ò–Ø
function updateSinglePointOnMap(objectId, newStatus) {
    const object = objectsData.find(obj => obj.id == objectId); // üî• –ò–°–ü–†–ê–í–õ–ï–ù–û: == –≤–º–µ—Å—Ç–æ ===
    if (!object) return;

    console.log(`üîÑ –¢–æ—á–µ—á–Ω–æ–µ –æ–±–Ω–æ–≤–ª–µ–Ω–∏–µ —Ç–æ—á–∫–∏ ${objectId} -> ${newStatus}`);

    // üî• –£–î–ê–õ–Ø–ï–ú –ò–ó –í–°–ï–• –°–õ–û–ï–í –°–†–ê–ó–£
    objectManager.remove(objectId);
    activeObjectsLayer.remove(objectId);

    const style = getInspectorStyle(object.inspector);
    let feature;

    if (newStatus === 'active') {
        // üîµ –ê–ö–¢–ò–í–ù–ê–Ø –¢–û–ß–ö–ê - –ë–û–õ–¨–®–û–ô –ö–†–£–ñ–û–ö
        feature = {
            type: 'Feature',
            id: object.id,
            geometry: {
                type: 'Point',
                coordinates: [parseFloat(object.latitude), parseFloat(object.longitude)]
            },
            properties: {
                hintContent: `üîµ –ê–ö–¢–ò–í–ù–ê –¢–æ—á–∫–∞ ‚Ññ${object.id} (${object.list || '–ë–µ–∑ —Å–ø–∏—Å–∫–∞'})`,
                balloonContent: getBalloonContent(object, style.icon),
                inspector: object.inspector,
                list: object.list,
                address: object.address,
                checklistLink: object.checklistLink,
                yandexDiskLink: object.yandexDiskLink
            },
            options: {
                preset: 'islands#circleIcon',
                iconColor: style.color,
                iconSize: [50, 50]
            }
        };
        activeObjectsLayer.add({ type: 'FeatureCollection', features: [feature] });
        
    } else if (newStatus === 'completed') {
        // ‚úÖ –í–´–ü–û–õ–ù–ï–ù–ù–ê–Ø –¢–û–ß–ö–ê - –ú–ï–î–ò–¶–ò–ù–°–ö–ò–ô –ö–†–ï–°–¢–ò–ö
        feature = {
            type: 'Feature',
            id: object.id,
            geometry: {
                type: 'Point',
                coordinates: [parseFloat(object.latitude), parseFloat(object.longitude)]
            },
            properties: {
                hintContent: `‚úÖ –í–´–ü–û–õ–ù–ï–ù–ê –¢–æ—á–∫–∞ ‚Ññ${object.id} (${object.list || '–ë–µ–∑ —Å–ø–∏—Å–∫–∞'})`,
                balloonContent: getBalloonContent(object, style.icon),
                inspector: object.inspector,
                list: object.list,
                address: object.address,
                checklistLink: object.checklistLink,
                yandexDiskLink: object.yandexDiskLink
            },
            options: {
                preset: 'islands#blueMedicalIcon',
                iconColor: style.color,
                iconSize: [30, 30]
            }
        };
        objectManager.add({ type: 'FeatureCollection', features: [feature] });
        
    } else if (newStatus === 'new') {
        // üü° –ù–û–í–ê–Ø –¢–û–ß–ö–ê - –°–¢–ê–ù–î–ê–†–¢–ù–ê–Ø –ú–ï–¢–ö–ê
        const isImperial = object.inspector === 'Admin' || 
                         (window.INSPECTORS_CONFIG[object.inspector] && 
                          window.INSPECTORS_CONFIG[object.inspector].accessRights === '–ò–º–ø–µ—Ä–∞—Ç–æ—Ä');
        const markerType = isImperial ? 'islands#blueStarIcon' : 'islands#dotIcon';
        
        feature = {
            type: 'Feature',
            id: object.id,
            geometry: {
                type: 'Point',
                coordinates: [parseFloat(object.latitude), parseFloat(object.longitude)]
            },
            properties: {
                hintContent: `üü° –¢–æ—á–∫–∞ ‚Ññ${object.id} (${object.list || '–ë–µ–∑ —Å–ø–∏—Å–∫–∞'})`,
                balloonContent: getBalloonContent(object, style.icon),
                inspector: object.inspector,
                list: object.list,
                address: object.address,
                checklistLink: object.checklistLink,
                yandexDiskLink: object.yandexDiskLink
            },
            options: {
                preset: markerType,
                iconColor: style.status === 'active' ? style.color : '#808080',
                iconSize: [30, 30]
            }
        };
        objectManager.add({ type: 'FeatureCollection', features: [feature] });
    }

    console.log('‚úÖ –¢–æ—á–µ—á–Ω–æ–µ –æ–±–Ω–æ–≤–ª–µ–Ω–∏–µ –∑–∞–≤–µ—Ä—à–µ–Ω–æ:', objectId, newStatus);
    
    // üî• –û–ë–ù–û–í–õ–Ø–ï–ú –ë–ê–õ–õ–£–ù –ï–°–õ–ò –û–ù –û–¢–ö–†–´–¢
    setTimeout(() => {
        const activeBalloon = objectManager.objects.balloon.getData() || activeObjectsLayer.objects.balloon.getData();
        if (activeBalloon && activeBalloon.feature.id == objectId) { // üî• –ò–°–ü–†–ê–í–õ–ï–ù–û: == –≤–º–µ—Å—Ç–æ ===
            showObjectBalloon(objectId);
        }
    }, 100);
}

        function showObjectBalloon(objectId) {
            const object = objectManager.objects.getById(objectId) || activeObjectsLayer.objects.getById(objectId);
            if (object) {
                if (objectManager.objects.getById(objectId)) {
                    objectManager.objects.balloon.open(objectId);
                } else {
                    activeObjectsLayer.objects.balloon.open(objectId);
                }
            }
        }

        function getBalloonContent(obj, icon) {
            const isNew = !obj.entryTime && !obj.exitTime;
            const isActive = obj.entryTime && !obj.exitTime;
            const isCompleted = !!obj.exitTime;
            
            let statusBadge;
            if (isCompleted) {
                statusBadge = '<span class="status-badge status-completed">‚úÖ –í–´–ü–û–õ–ù–ï–ù–û</span>';
            } else if (isActive) {
                statusBadge = '<span class="status-badge status-active">üîµ –ê–ö–¢–ò–í–ù–ê</span>';
            } else {
                statusBadge = '<span class="status-badge status-new">üÜï –ù–û–í–ê–Ø</span>';
            }

            const coordinates = `${obj.latitude}, ${obj.longitude}`;
            
            const checklistButton = obj.checklistLink ? 
                `<a href="${obj.checklistLink}" target="_blank" class="checklist-btn">üìã –ß–µ–∫-–ª–∏—Å—Ç</a>` : '';

            const yandexDiskButton = obj.yandexDiskLink ? 
                `<a href="${obj.yandexDiskLink}" target="_blank" class="yandex-disk-btn">üìÅ –Ø–Ω–¥–µ–∫—Å –î–∏—Å–∫</a>` : '';

            const canMarkEntryExit = (userAccessRights === '–ò–º–ø–µ—Ä–∞—Ç–æ—Ä' || userAccessRights === '–ê–¥–º–∏–Ω–∏—Å—Ç—Ä–∞—Ç–æ—Ä') || 
                                   isSameInspector(obj.inspector, currentUser);

            let entryExitButtons = '';
            let entryWarning = '';
            
            if (!isCompleted) {
                if (isNew && canMarkEntryExit) {
                    const canEnter = canInspectorEnterObject(obj.inspector, obj.id);
                    
                    if (canEnter.canEnter) {
                        entryExitButtons = `
                            <div class="entry-exit-buttons">
                                <button class="entry-btn" onclick="markEntry(${obj.id})">üö™ –í—Ö–æ–¥</button>
                            </div>
                        `;
                    } else {
                        entryExitButtons = `
                            <div class="entry-exit-buttons">
                                <button class="entry-btn" disabled>üö™ –í—Ö–æ–¥</button>
                            </div>
                        `;
                        entryWarning = `<div class="entry-warning">${canEnter.message}</div>`;
                        
                        if (canEnter.activeObjectId) {
                            entryWarning += `<div class="entry-warning" style="margin-top: 5px; cursor: pointer;" onclick="map.setCenter([${objectsData.find(o => o.id == canEnter.activeObjectId).latitude}, ${objectsData.find(o => o.id == canEnter.activeObjectId).longitude}], 17)">üìç –ü–µ—Ä–µ–π—Ç–∏ –∫ –∞–∫—Ç–∏–≤–Ω–æ–º—É –æ–±—ä–µ–∫—Ç—É ${canEnter.activeObjectId}</div>`;
                        }
                    }
                } else if (isActive && canMarkEntryExit) {
                    entryExitButtons = `
                        <div class="entry-exit-buttons">
                            <button class="exit-btn" onclick="markExit(${obj.id})">üö™ –í—ã—Ö–æ–¥</button>
                        </div>
                    `;
                    
                    if (userAccessRights === '–ò–º–ø–µ—Ä–∞—Ç–æ—Ä' || userAccessRights === '–ê–¥–º–∏–Ω–∏—Å—Ç—Ä–∞—Ç–æ—Ä') {
                        entryExitButtons += `
                            <div class="entry-exit-buttons">
                                <button class="cancel-entry-btn" onclick="cancelEntry(${obj.id})">‚ùå –û—Ç–º–µ–Ω–∏—Ç—å –≤—Ö–æ–¥</button>
                            </div>
                        `;
                    }
                } else if (!canMarkEntryExit) {
                    entryExitButtons = `
                        <div style="margin-top: 10px; padding: 8px; background: #f8d7da; color: #721c24; border-radius: 4px; font-size: 12px;">
                            ‚ö†Ô∏è –î–æ—Å—Ç—É–ø–Ω–æ —Ç–æ–ª—å–∫–æ –∏–Ω—Å–ø–µ–∫—Ç–æ—Ä—É: ${obj.inspector}
                        </div>
                    `;
                }
            } else {
                entryExitButtons = `
                    <div style="color: #999; text-align: center; margin-top: 10px;">
                        üö´ –î–µ–π—Å—Ç–≤–∏—è –Ω–µ–¥–æ—Å—Ç—É–ø–Ω—ã
                    </div>
                `;
            }

            const reassignSelect = (userAccessRights === '–ò–º–ø–µ—Ä–∞—Ç–æ—Ä' || userAccessRights === '–ê–¥–º–∏–Ω–∏—Å—Ç—Ä–∞—Ç–æ—Ä' && !isCompleted) ? `
                <div style="margin-top: 10px;">
                    <label><strong>üîÑ –ü–µ—Ä–µ–Ω–∞–∑–Ω–∞—á–∏—Ç—å –∏–Ω—Å–ø–µ–∫—Ç–æ—Ä–∞:</strong></label>
                    <select class="reassign-select" onchange="reassignInspector(${obj.id}, this.value)">
                        <option value="">-- –í—ã–±–µ—Ä–∏—Ç–µ –∏–Ω—Å–ø–µ–∫—Ç–æ—Ä–∞ --</option>
                        ${Object.keys(window.INSPECTOR_HOMES || {}).map(inspector => {
                            const style = getInspectorStyle(inspector);
                            const statusText = style.status !== 'active' ? ` (${getStatusText(style.status)})` : '';
                            const isCurrent = obj.inspector === inspector;
                            return `<option value="${inspector}" ${isCurrent ? 'selected' : ''} ${style.status !== 'active' ? 'disabled' : ''}>
                                ${style.icon} ${inspector}${statusText} ${isCurrent ? ' ‚Üê —Ç–µ–∫—É—â–∏–π' : ''}
                            </option>`;
                        }).join('')}
                    </select>
                </div>
            ` : '';

            return `
                <div class="balloon-content">
                    <h3>${icon} –¢–æ—á–∫–∞ ‚Ññ${obj.id} (${obj.list || '–ë–µ–∑ —Å–ø–∏—Å–∫–∞'})</h3>
                    <p><strong>–ê–¥—Ä–µ—Å:</strong> ${obj.address}</p>
                    <p><strong>–ò–Ω—Å–ø–µ–∫—Ç–æ—Ä:</strong> ${obj.inspector || '–ù–µ –Ω–∞–∑–Ω–∞—á–µ–Ω'}</p>
                    ${statusBadge}
                    
                    <div class="button-group">
                        <button class="coordinates-btn" onclick="copyCoordinates('${coordinates}')">üìã –ö–æ–æ—Ä–¥–∏–Ω–∞—Ç—ã</button>
                        ${checklistButton}
                        ${yandexDiskButton}
                    </div>

                    ${entryExitButtons}
                    ${entryWarning}
                    ${reassignSelect}
                </div>
            `;
        }

        function checkInspectorActiveObject(inspector) {
            if (!inspector) return null;
            
            const activeObject = objectsData.find(obj => 
                obj.inspector === inspector && 
                obj.entryTime && 
                !obj.exitTime
            );
            
            return activeObject;
        }

        function canInspectorEnterObject(inspector, objectId) {
            if (userAccessRights === '–ò–º–ø–µ—Ä–∞—Ç–æ—Ä' || userAccessRights === '–ê–¥–º–∏–Ω–∏—Å—Ç—Ä–∞—Ç–æ—Ä') {
                return { canEnter: true };
            }
            
            const activeObject = checkInspectorActiveObject(inspector);
            
            if (activeObject) {
                if (activeObject.id == objectId) {
                    return { canEnter: false, message: '–í—ã —É–∂–µ –Ω–∞—Ö–æ–¥–∏—Ç–µ—Å—å –Ω–∞ —ç—Ç–æ–º –æ–±—ä–µ–∫—Ç–µ' };
                } else {
                    return { 
                        canEnter: false, 
                        message: `–ù–µ–ª—å–∑—è –≤–æ–π—Ç–∏ –Ω–∞ –æ–±—ä–µ–∫—Ç ${objectId}. –°–Ω–∞—á–∞–ª–∞ –∑–∞–≤–µ—Ä—à–∏—Ç–µ –æ–±—ä–µ–∫—Ç ${activeObject.id}`,
                        activeObjectId: activeObject.id
                    };
                }
            }
            
            return { canEnter: true };
        }

        function getStatusText(status) {
            switch(status) {
                case 'active': return 'üü¢ –ê–∫—Ç–∏–≤–µ–Ω';
                case 'vacation': return 'üèñÔ∏è –í –æ—Ç–ø—É—Å–∫–µ';
                case 'sick': return 'ü§í –ù–∞ –±–æ–ª—å–Ω–∏—á–Ω–æ–º';
                default: return '‚ùì –ù–µ–∏–∑–≤–µ—Å—Ç–Ω–æ';
            }
        }

        function copyCoordinates(coordinates) {
            navigator.clipboard.writeText(coordinates).then(() => {
                showNotification('‚úÖ –ö–æ–æ—Ä–¥–∏–Ω–∞—Ç—ã —Å–∫–æ–ø–∏—Ä–æ–≤–∞–Ω—ã: ' + coordinates, 'success');
            }).catch(() => {
                const textArea = document.createElement('textarea');
                textArea.value = coordinates;
                document.body.appendChild(textArea);
                textArea.select();
                document.execCommand('copy');
                document.body.removeChild(textArea);
                showNotification('‚úÖ –ö–æ–æ—Ä–¥–∏–Ω–∞—Ç—ã —Å–∫–æ–ø–∏—Ä–æ–≤–∞–Ω—ã: ' + coordinates, 'success');
            });
        }

        // üî• –†–ê–ë–û–¢–ê –° –¢–û–ß–ö–ê–ú–ò - –£–õ–£–ß–®–ï–ù–ù–ê–Ø –í–ï–†–°–ò–Ø
        function markEntry(objectId) {
    const object = objectsData.find(obj => obj.id == objectId); // üî• –ò–°–ü–†–ê–í–õ–ï–ù–û: == –≤–º–µ—Å—Ç–æ ===
    if (!object) {
        showNotification('‚ùå –û–±—ä–µ–∫—Ç –Ω–µ –Ω–∞–π–¥–µ–Ω', 'error');
        return;
    }
    
    const canMarkEntryExit = (userAccessRights === '–ò–º–ø–µ—Ä–∞—Ç–æ—Ä' || userAccessRights === '–ê–¥–º–∏–Ω–∏—Å—Ç—Ä–∞—Ç–æ—Ä') || 
                           isSameInspector(object.inspector, currentUser);
    
    if (!canMarkEntryExit) {
        showNotification('‚ùå –ù–µ–¥–æ—Å—Ç–∞—Ç–æ—á–Ω–æ –ø—Ä–∞–≤ –¥–ª—è –æ—Ç–º–µ—Ç–∫–∏ –≤—Ö–æ–¥–∞ –Ω–∞ —á—É–∂–æ–π –æ–±—ä–µ–∫—Ç', 'error');
        return;
    }

    if (userAccessRights === '–ò–Ω—Å–ø–µ–∫—Ç–æ—Ä') {
        const canEnter = canInspectorEnterObject(currentUser, objectId);
        if (!canEnter.canEnter) {
            showNotification('‚ùå ' + canEnter.message, 'error');
            if (canEnter.activeObjectId) {
                setTimeout(() => {
                    const activeObj = objectsData.find(o => o.id == canEnter.activeObjectId); // üî• –ò–°–ü–†–ê–í–õ–ï–ù–û: == –≤–º–µ—Å—Ç–æ ===
                    if (activeObj) {
                        map.setCenter([parseFloat(activeObj.latitude), parseFloat(activeObj.longitude)], 17);
                        showObjectBalloon(activeObj.id);
                    }
                }, 1000);
            }
            return;
        }
    }

    performMarkEntry(objectId);
}

        function markExit(objectId) {
    const object = objectsData.find(obj => obj.id == objectId); // üî• –ò–°–ü–†–ê–í–õ–ï–ù–û: == –≤–º–µ—Å—Ç–æ ===
    if (!object) {
        showNotification('‚ùå –û–±—ä–µ–∫—Ç –Ω–µ –Ω–∞–π–¥–µ–Ω', 'error');
        return;
    }
    
    const canMarkEntryExit = (userAccessRights === '–ò–º–ø–µ—Ä–∞—Ç–æ—Ä' || userAccessRights === '–ê–¥–º–∏–Ω–∏—Å—Ç—Ä–∞—Ç–æ—Ä') || 
                           isSameInspector(object.inspector, currentUser);
    
    if (!canMarkEntryExit) {
        showNotification('‚ùå –ù–µ–¥–æ—Å—Ç–∞—Ç–æ—á–Ω–æ –ø—Ä–∞–≤ –¥–ª—è –æ—Ç–º–µ—Ç–∫–∏ –≤—ã—Ö–æ–¥–∞ –Ω–∞ —á—É–∂–æ–π –æ–±—ä–µ–∫—Ç', 'error');
        return;
    }

    performMarkExit(objectId);
}

       function performMarkEntry(objectId) {
    showNotification('üîÑ –û—Ç–º–µ—á–∞–µ–º –≤—Ö–æ–¥...', 'success');
    
    const callbackName = 'entryCallback_' + Date.now();
    
    const cleanupCallback = function() {
        setTimeout(() => {
            if (window[callbackName]) {
                delete window[callbackName];
            }
        }, 10000);
    };
    
    window[callbackName] = function(result) {
        cleanupCallback();
        if (result.success && result.updated) {
            showNotification(`‚úÖ –í—Ö–æ–¥ –æ—Ç–º–µ—á–µ–Ω –¥–ª—è —Ç–æ—á–∫–∏ ${objectId}`, 'success');
            
            // üî• –ú–ì–ù–û–í–ï–ù–ù–û–ï –û–ë–ù–û–í–õ–ï–ù–ò–ï –ö–ê–†–¢–´ –ò –î–ê–ù–ù–´–•
            const object = objectsData.find(obj => obj.id == objectId); // üî• –ò–°–ü–†–ê–í–õ–ï–ù–û: == –≤–º–µ—Å—Ç–æ ===
            if (object) {
                object.entryTime = new Date().toISOString();
                updateSinglePointOnMap(objectId, 'active');
            }
            
            // –û–±–Ω–æ–≤–ª—è–µ–º –¥–∞–Ω–Ω—ã–µ –≤ —Ñ–æ–Ω–µ
            setTimeout(() => loadData(), 2000);
        } else {
            showNotification('‚ùå –û—à–∏–±–∫–∞: ' + (result.message || '–ù–µ —É–¥–∞–ª–æ—Å—å –æ—Ç–º–µ—Ç–∏—Ç—å –≤—Ö–æ–¥'), 'error');
        }
    };
    
    const url = `${SCRIPT_URL}?action=entry&objectId=${objectId}&callback=${callbackName}`;
    const script = document.createElement('script');
    script.src = url;
    script.onerror = function() {
        cleanupCallback();
        showNotification('‚ùå –û—à–∏–±–∫–∞ —Å–æ–µ–¥–∏–Ω–µ–Ω–∏—è —Å —Å–µ—Ä–≤–µ—Ä–æ–º', 'error');
    };
    document.head.appendChild(script);
    cleanupCallback();
}

       function performMarkExit(objectId) {
    showNotification('üîÑ –û—Ç–º–µ—á–∞–µ–º –≤—ã—Ö–æ–¥...', 'success');
    
    const callbackName = 'exitCallback_' + Date.now();
    
    const cleanupCallback = function() {
        setTimeout(() => {
            if (window[callbackName]) {
                delete window[callbackName];
            }
        }, 15000);
    };
    
    window[callbackName] = function(result) {
        cleanupCallback();
        console.log('üü° –û—Ç–≤–µ—Ç –æ—Ç —Å–µ—Ä–≤–µ—Ä–∞ –ø—Ä–∏ –≤—ã—Ö–æ–¥–µ:', result);
        
        if (result.success && result.updated) {
            showNotification(`‚úÖ –í—ã—Ö–æ–¥ –æ—Ç–º–µ—á–µ–Ω –∏ —Ç–æ—á–∫–∞ ${objectId} –≤—ã–ø–æ–ª–Ω–µ–Ω–∞`, 'success');
            
            // üî• –ú–ì–ù–û–í–ï–ù–ù–û–ï –û–ë–ù–û–í–õ–ï–ù–ò–ï –ö–ê–†–¢–´ –ò –î–ê–ù–ù–´–•
            const object = objectsData.find(obj => obj.id == objectId); // üî• –ò–°–ü–†–ê–í–õ–ï–ù–û: == –≤–º–µ—Å—Ç–æ ===
            if (object) {
                object.exitTime = new Date().toISOString();
                updateSinglePointOnMap(objectId, 'completed');
            }
            
            // –û–±–Ω–æ–≤–ª—è–µ–º –¥–∞–Ω–Ω—ã–µ –≤ —Ñ–æ–Ω–µ
            setTimeout(() => loadData(), 2000);
            
        } else {
            showNotification('‚ùå –û—à–∏–±–∫–∞: ' + (result.message || '–ù–µ —É–¥–∞–ª–æ—Å—å –æ—Ç–º–µ—Ç–∏—Ç—å –≤—ã—Ö–æ–¥'), 'error');
            console.error('‚ùå –û—à–∏–±–∫–∞ –ø—Ä–∏ –≤—ã—Ö–æ–¥–µ:', result);
        }
    };
    
    const timestamp = Date.now();
    const random = Math.random().toString(36).substring(7);
    const url = `${SCRIPT_URL}?action=exit&objectId=${objectId}&_=${timestamp}&r=${random}&callback=${callbackName}`;
    
    console.log('üü° –û—Ç–ø—Ä–∞–≤–ª—è–µ–º –∑–∞–ø—Ä–æ—Å –Ω–∞ –≤—ã—Ö–æ–¥:', url);
    const script = document.createElement('script');
    script.src = url;
    script.onerror = function() {
        cleanupCallback();
        showNotification('‚ùå –û—à–∏–±–∫–∞ —Å–æ–µ–¥–∏–Ω–µ–Ω–∏—è —Å —Å–µ—Ä–≤–µ—Ä–æ–º', 'error');
    };
    document.head.appendChild(script);
    cleanupCallback();
}

       function cancelEntry(objectId) {
    if (!(userAccessRights === '–ò–º–ø–µ—Ä–∞—Ç–æ—Ä' || userAccessRights === '–ê–¥–º–∏–Ω–∏—Å—Ç—Ä–∞—Ç–æ—Ä')) {
        showNotification('‚ùå –¢–æ–ª—å–∫–æ –∞–¥–º–∏–Ω–∏—Å—Ç—Ä–∞—Ç–æ—Ä –º–æ–∂–µ—Ç –æ—Ç–º–µ–Ω—è—Ç—å –≤—Ö–æ–¥', 'error');
        return;
    }
    
    const object = objectsData.find(obj => obj.id == objectId); // üî• –ò–°–ü–†–ê–í–õ–ï–ù–û: == –≤–º–µ—Å—Ç–æ ===
    if (!object) {
        showNotification('‚ùå –û–±—ä–µ–∫—Ç –Ω–µ –Ω–∞–π–¥–µ–Ω', 'error');
        return;
    }
    
    if (!object.entryTime || object.exitTime) {
        showNotification('‚ùå –û–±—ä–µ–∫—Ç –Ω–µ –Ω–∞—Ö–æ–¥–∏—Ç—Å—è –≤ –∞–∫—Ç–∏–≤–Ω–æ–º —Å—Ç–∞—Ç—É—Å–µ', 'error');
        return;
    }
    
    if (!confirm(`–û—Ç–º–µ–Ω–∏—Ç—å –≤—Ö–æ–¥ –Ω–∞ –æ–±—ä–µ–∫—Ç ${objectId}? –û–±—ä–µ–∫—Ç –≤–µ—Ä–Ω–µ—Ç—Å—è –≤ —Å—Ç–∞—Ç—É—Å "–ù–æ–≤–∞—è".`)) {
        return;
    }
    
    showNotification('üîÑ –û—Ç–º–µ–Ω—è–µ–º –≤—Ö–æ–¥...', 'success');
    
    const callbackName = 'cancelEntryCallback_' + Date.now();
    
    const cleanupCallback = function() {
        setTimeout(() => {
            if (window[callbackName]) {
                delete window[callbackName];
            }
        }, 10000);
    };
    
    window[callbackName] = function(result) {
        cleanupCallback();
        if (result.success && result.updated) {
            showNotification(`‚úÖ –í—Ö–æ–¥ –æ—Ç–º–µ–Ω–µ–Ω –¥–ª—è —Ç–æ—á–∫–∏ ${objectId}`, 'success');
            
            // üî• –ú–ì–ù–û–í–ï–ù–ù–û–ï –û–ë–ù–û–í–õ–ï–ù–ò–ï –ö–ê–†–¢–´
            const object = objectsData.find(obj => obj.id == objectId); // üî• –ò–°–ü–†–ê–í–õ–ï–ù–û: == –≤–º–µ—Å—Ç–æ ===
            if (object) {
                object.entryTime = '';
                updateSinglePointOnMap(objectId, 'new');
            }
            
            loadData();
        } else {
            showNotification('‚ùå –û—à–∏–±–∫–∞: ' + (result.message || '–ù–µ —É–¥–∞–ª–æ—Å—å –æ—Ç–º–µ–Ω–∏—Ç—å –≤—Ö–æ–¥'), 'error');
        }
    };
    
    const url = `${SCRIPT_URL}?action=cancelEntry&objectId=${objectId}&callback=${callbackName}`;
    const script = document.createElement('script');
    script.src = url;
    script.onerror = function() {
        cleanupCallback();
        showNotification('‚ùå –û—à–∏–±–∫–∞ —Å–æ–µ–¥–∏–Ω–µ–Ω–∏—è —Å —Å–µ—Ä–≤–µ—Ä–æ–º', 'error');
    };
    document.head.appendChild(script);
    cleanupCallback();
}

       // üî• –ü–ï–†–ï–†–ê–°–ü–†–ï–î–ï–õ–ï–ù–ò–ï –ò–ù–°–ü–ï–ö–¢–û–†–ê - –£–õ–£–ß–®–ï–ù–ù–ê–Ø –í–ï–†–°–ò–Ø
function reassignInspector(objectId, newInspector) {
    if (!(userAccessRights === '–ò–º–ø–µ—Ä–∞—Ç–æ—Ä' || userAccessRights === '–ê–¥–º–∏–Ω–∏—Å—Ç—Ä–∞—Ç–æ—Ä')) return;
    if (!newInspector) return;
    
    console.log('üü° –ü–µ—Ä–µ–Ω–∞–∑–Ω–∞—á–µ–Ω–∏–µ:', objectId, '‚Üí', newInspector);
    
    // üî• –ó–ê–ö–†–´–í–ê–ï–ú –ë–ê–õ–õ–£–ù –ü–ï–†–ï–î –í–´–ü–û–õ–ù–ï–ù–ò–ï–ú –î–ï–ô–°–¢–í–ò–Ø
    objectManager.objects.balloon.close();
    activeObjectsLayer.objects.balloon.close();
    
    const callbackName = 'reassignCallback_' + Date.now();
    
    const cleanupCallback = function() {
        setTimeout(() => {
            if (window[callbackName]) {
                delete window[callbackName];
            }
        }, 10000);
    };
    
    window[callbackName] = function(result) {
        cleanupCallback();
        if (result.success) {
            showNotification(`‚úÖ –¢–æ—á–∫–∞ ${objectId} –ø–µ—Ä–µ–Ω–∞–∑–Ω–∞—á–µ–Ω–∞ ${newInspector}`, 'success');
            
            // üî• –ú–ì–ù–û–í–ï–ù–ù–û–ï –û–ë–ù–û–í–õ–ï–ù–ò–ï –ö–ê–†–¢–´
            const object = objectsData.find(obj => obj.id == objectId); // üî• –ò–°–ü–†–ê–í–õ–ï–ù–û: == –≤–º–µ—Å—Ç–æ ===
            if (object) {
                object.inspector = newInspector;
                const isActive = object.entryTime && !object.exitTime;
                updateSinglePointOnMap(objectId, isActive ? 'active' : 'new');
            }
            
            // üî• –ê–í–¢–û–ú–ê–¢–ò–ß–ï–°–ö–û–ï –û–ë–ù–û–í–õ–ï–ù–ò–ï –§–ò–õ–¨–¢–†–û–í –ß–ï–†–ï–ó 3 –°–ï–ö–£–ù–î–´
            setTimeout(() => {
                // –°–∫—Ä—ã–≤–∞–µ–º –≤—Å–µ —Ç–æ—á–∫–∏
                deselectAllLists();
                
                // –ú–≥–Ω–æ–≤–µ–Ω–Ω–æ –ø–æ–∫–∞–∑—ã–≤–∞–µ–º –≤—Å–µ —Ç–æ—á–∫–∏
                setTimeout(() => {
                    selectAllLists();
                    updateMap();
                }, 100);
                
                showNotification('üîÑ –û–±–Ω–æ–≤–ª–µ–Ω–∏–µ —Ñ–∏–ª—å—Ç—Ä–æ–≤ –¥–ª—è –æ—Ç–æ–±—Ä–∞–∂–µ–Ω–∏—è –∏–∑–º–µ–Ω–µ–Ω–∏–π', 'success');
            }, 3000);
            
        } else {
            showNotification('‚ùå –û—à–∏–±–∫–∞ –ø–µ—Ä–µ–Ω–∞–∑–Ω–∞—á–µ–Ω–∏—è: ' + result.message, 'error');
        }
    };
    
    const url = `${SCRIPT_URL}?action=reassign&objectId=${objectId}&newInspector=${encodeURIComponent(newInspector)}&callback=${callbackName}`;
    const script = document.createElement('script');
    script.src = url;
    
    script.onerror = function() {
        cleanupCallback();
        showNotification('‚ùå –û—à–∏–±–∫–∞ —Å–æ–µ–¥–∏–Ω–µ–Ω–∏—è —Å —Å–µ—Ä–≤–µ—Ä–æ–º', 'error');
    };
    
    document.head.appendChild(script);
    cleanupCallback();
}

        // üî• –†–ê–ë–û–ß–ò–ô –î–ï–ù–¨
        function checkWorkDayStatus() {
            if (userAccessRights === '–ò–º–ø–µ—Ä–∞—Ç–æ—Ä' || userAccessRights === '–ê–¥–º–∏–Ω–∏—Å—Ç—Ä–∞—Ç–æ—Ä') return;
            
            const localStatus = getWorkDayStatus();
            if (localStatus.isOpen) {
                console.log('üîÑ –í–æ—Å—Å—Ç–∞–Ω–∞–≤–ª–∏–≤–∞–µ–º –ª–æ–∫–∞–ª—å–Ω—ã–π —Å—Ç–∞—Ç—É—Å —Ä–∞–±–æ—á–µ–≥–æ –¥–Ω—è: –æ—Ç–∫—Ä—ã—Ç');
                isWorkDayOpen = true;
                updateWorkDayButtons();
                return;
            }
            
            const callbackName = 'checkWorkDayCallback_' + Date.now();
            
            const cleanupCallback = function() {
                setTimeout(() => {
                    if (window[callbackName]) {
                        delete window[callbackName];
                    }
                }, 10000);
            };
            
            window[callbackName] = function(result) {
                cleanupCallback();
                if (result.success) {
                    isWorkDayOpen = result.isWorkDayOpen;
                    
                    if (isWorkDayOpen) {
                        saveWorkDayStatus(true);
                    } else {
                        saveWorkDayStatus(false);
                    }
                    
                    updateWorkDayButtons();
                    showNotification(isWorkDayOpen ? 'üü¢ –†–∞–±–æ—á–∏–π –¥–µ–Ω—å –æ—Ç–∫—Ä—ã—Ç' : 'üî¥ –†–∞–±–æ—á–∏–π –¥–µ–Ω—å –∑–∞–∫—Ä—ã—Ç', 'success');
                }
            };
            
            const url = `${SCRIPT_URL}?action=checkWorkDay&inspector=${encodeURIComponent(currentUser)}&callback=${callbackName}`;
            const script = document.createElement('script');
            script.src = url;
            script.onerror = function() {
                cleanupCallback();
            };
            document.head.appendChild(script);
            cleanupCallback();
        }

       function updateWorkDayButtons() {
    const openBtn = document.getElementById('openDayBtn');
    const closeBtn = document.getElementById('closeDayBtn');
    const indicator = document.getElementById('workDayIndicator');
    
    if (!openBtn || !closeBtn || !indicator) return;
    
    if (isWorkDayOpen) {
        // üîµ –î–µ–Ω—å –æ—Ç–∫—Ä—ã—Ç
        openBtn.disabled = true;
        closeBtn.disabled = false;
        
        const localStatus = getWorkDayStatus();
        let statusText = '–°—Ç–∞—Ç—É—Å: –î–µ–Ω—å –æ—Ç–∫—Ä—ã—Ç';
        
        if (localStatus.startTime) {
            const startDate = new Date(localStatus.startTime);
            const timeString = startDate.toLocaleTimeString('ru-RU', { 
                hour: '2-digit', 
                minute: '2-digit' 
            });
            statusText = `–°—Ç–∞—Ç—É—Å: –î–µ–Ω—å –æ—Ç–∫—Ä—ã—Ç (—Å ${timeString})`;
        }
        
        indicator.textContent = statusText;
        indicator.className = 'work-day-indicator open';
        
    } else {
        // üî¥ –î–µ–Ω—å –∑–∞–∫—Ä—ã—Ç
        openBtn.disabled = false;
        closeBtn.disabled = true;
        indicator.textContent = '–°—Ç–∞—Ç—É—Å: –î–µ–Ω—å –∑–∞–∫—Ä—ã—Ç';
        indicator.className = 'work-day-indicator closed';
    }
}

        function startWorkDay() {
            if (userAccessRights === '–ò–º–ø–µ—Ä–∞—Ç–æ—Ä' || userAccessRights === '–ê–¥–º–∏–Ω–∏—Å—Ç—Ä–∞—Ç–æ—Ä') {
                showNotification('‚ùå –ê–¥–º–∏–Ω–∏—Å—Ç—Ä–∞—Ç–æ—Ä –Ω–µ –º–æ–∂–µ—Ç –æ—Ç–∫—Ä—ã–≤–∞—Ç—å —Ä–∞–±–æ—á–∏–π –¥–µ–Ω—å', 'error');
                return;
            }
            
            if (isWorkDayOpen) {
                showNotification('‚ÑπÔ∏è –†–∞–±–æ—á–∏–π –¥–µ–Ω—å —É–∂–µ –æ—Ç–∫—Ä—ã—Ç', 'success');
                return;
            }
            
            if (!navigator.geolocation) {
                showNotification('‚ùå –ì–µ–æ–ª–æ–∫–∞—Ü–∏—è –Ω–µ –ø–æ–¥–¥–µ—Ä–∂–∏–≤–∞–µ—Ç—Å—è –±—Ä–∞—É–∑–µ—Ä–æ–º', 'error');
                return;
            }

            showNotification('üîÑ –û—Ç–∫—Ä—ã–≤–∞–µ–º —Ä–∞–±–æ—á–∏–π –¥–µ–Ω—å...', 'success');

            navigator.geolocation.getCurrentPosition(
                (position) => {
                    const coords = `${position.coords.latitude}, ${position.coords.longitude}`;
                    const startTime = new Date().toISOString();
                    
                    const callbackName = 'startWorkDayCallback_' + Date.now();
                    
                    const cleanupCallback = function() {
                        setTimeout(() => {
                            if (window[callbackName]) {
                                delete window[callbackName];
                            }
                        }, 10000);
                    };
                    
                    window[callbackName] = function(result) {
                        cleanupCallback();
                        if (result.success) {
                            isWorkDayOpen = true;
                            
                            saveWorkDayStatus(true, startTime);
                            
                            updateWorkDayButtons();
                            showNotification(`‚úÖ –†–∞–±–æ—á–∏–π –¥–µ–Ω—å –æ—Ç–∫—Ä—ã—Ç!`, 'success');
                        } else {
                            showNotification('‚ùå –û—à–∏–±–∫–∞: ' + result.message, 'error');
                        }
                    };
                    
                    const url = `${SCRIPT_URL}?action=startWorkDay&inspector=${encodeURIComponent(currentUser)}&coords=${encodeURIComponent(coords)}&callback=${callbackName}`;
                    const script = document.createElement('script');
                    script.src = url;
                    script.onerror = function() {
                        cleanupCallback();
                        showNotification('‚ùå –û—à–∏–±–∫–∞ —Å–æ–µ–¥–∏–Ω–µ–Ω–∏—è —Å —Å–µ—Ä–≤–µ—Ä–æ–º', 'error');
                    };
                    document.head.appendChild(script);
                    cleanupCallback();
                },
                (error) => {
                    showNotification('‚ùå –ù–µ —É–¥–∞–ª–æ—Å—å –ø–æ–ª—É—á–∏—Ç—å –º–µ—Å—Ç–æ–ø–æ–ª–æ–∂–µ–Ω–∏–µ', 'error');
                },
                {
                    enableHighAccuracy: true,
                    timeout: 10000,
                    maximumAge: 60000
                }
            );
        }

        function endWorkDay() {
            if (userAccessRights === '–ò–º–ø–µ—Ä–∞—Ç–æ—Ä' || userAccessRights === '–ê–¥–º–∏–Ω–∏—Å—Ç—Ä–∞—Ç–æ—Ä') {
                showNotification('‚ùå –ê–¥–º–∏–Ω–∏—Å—Ç—Ä–∞—Ç–æ—Ä –Ω–µ –º–æ–∂–µ—Ç –∑–∞–∫—Ä—ã–≤–∞—Ç—å —Ä–∞–±–æ—á–∏–π –¥–µ–Ω—å', 'error');
                return;
            }
            
            if (!isWorkDayOpen) {
                showNotification('‚ÑπÔ∏è –†–∞–±–æ—á–∏–π –¥–µ–Ω—å —É–∂–µ –∑–∞–∫—Ä—ã—Ç', 'success');
                return;
            }
            
            if (!navigator.geolocation) {
                showNotification('‚ùå –ì–µ–æ–ª–æ–∫–∞—Ü–∏—è –Ω–µ –ø–æ–¥–¥–µ—Ä–∂–∏–≤–∞–µ—Ç—Å—è –±—Ä–∞—É–∑–µ—Ä–æ–º', 'error');
                return;
            }

            showNotification('üîÑ –ó–∞–∫—Ä—ã–≤–∞–µ–º —Ä–∞–±–æ—á–∏–π –¥–µ–Ω—å...', 'success');

            navigator.geolocation.getCurrentPosition(
                (position) => {
                    const coords = `${position.coords.latitude}, ${position.coords.longitude}`;
                    
                    const callbackName = 'endWorkDayCallback_' + Date.now();
                    
                    const cleanupCallback = function() {
                        setTimeout(() => {
                            if (window[callbackName]) {
                                delete window[callbackName];
                            }
                        }, 10000);
                    };
                    
                    window[callbackName] = function(result) {
                        cleanupCallback();
                        if (result.success) {
                            isWorkDayOpen = false;
                            
                            saveWorkDayStatus(false);
                            
                            updateWorkDayButtons();
                            showNotification(`‚úÖ –†–∞–±–æ—á–∏–π –¥–µ–Ω—å –∑–∞–∫—Ä—ã—Ç!`, 'success');
                        } else {
                            showNotification('‚ùå –û—à–∏–±–∫–∞: ' + result.message, 'error');
                        }
                    };
                    
                    const url = `${SCRIPT_URL}?action=endWorkDay&inspector=${encodeURIComponent(currentUser)}&coords=${encodeURIComponent(coords)}&callback=${callbackName}`;
                    const script = document.createElement('script');
                    script.src = url;
                    script.onerror = function() {
                        cleanupCallback();
                        showNotification('‚ùå –û—à–∏–±–∫–∞ —Å–æ–µ–¥–∏–Ω–µ–Ω–∏—è —Å —Å–µ—Ä–≤–µ—Ä–æ–º', 'error');
                    };
                    document.head.appendChild(script);
                    cleanupCallback();
                },
                (error) => {
                    showNotification('‚ùå –ù–µ —É–¥–∞–ª–æ—Å—å –ø–æ–ª—É—á–∏—Ç—å –º–µ—Å—Ç–æ–ø–æ–ª–æ–∂–µ–Ω–∏–µ', 'error');
                },
                {
                    enableHighAccuracy: true,
                    timeout: 10000,
                    maximumAge: 60000
                }
            );
        }

        // üî• –ê–î–ú–ò–ù–ò–°–¢–†–ê–¢–ò–í–ù–´–ï –§–£–ù–ö–¶–ò–ò
        function toggleInspectorsHomes() {
            showInspectorsHomes = !showInspectorsHomes;
            updateInspectorsHomesLayer();
            showNotification(showInspectorsHomes ? 'üè† –î–æ–º–∞ –∏–Ω—Å–ø–µ–∫—Ç–æ—Ä–æ–≤ –ø–æ–∫–∞–∑–∞–Ω—ã' : 'üè† –î–æ–º–∞ –∏–Ω—Å–ø–µ–∫—Ç–æ—Ä–æ–≤ —Å–∫—Ä—ã—Ç—ã', 'success');
        }

        function updateInspectorsHomesLayer() {
            inspectorsHomesLayer.removeAll();
            
            if (showInspectorsHomes && (userAccessRights === '–ò–º–ø–µ—Ä–∞—Ç–æ—Ä' || userAccessRights === '–ê–¥–º–∏–Ω–∏—Å—Ç—Ä–∞—Ç–æ—Ä')) {
                const homeFeatures = Object.keys(window.INSPECTOR_HOMES || {}).map(inspector => {
                    const home = window.INSPECTOR_HOMES[inspector];
                    const style = getInspectorStyle(inspector);
                    
                    return {
                        type: 'Feature',
                        id: 'home_' + inspector,
                        geometry: {
                            type: 'Point',
                            coordinates: [home.lat, home.lon]
                        },
                        properties: {
                            hintContent: `üè† ${inspector}`,
                            balloonContent: `
                                <div style="padding: 10px; min-width: 250px;">
                                    <h3>üè† ${inspector}</h3>
                                    <p><strong>–ê–¥—Ä–µ—Å:</strong> ${home.address}</p>
                                    <p><strong>–ö–æ–æ—Ä–¥–∏–Ω–∞—Ç—ã:</strong> ${home.lat}, ${home.lon}</p>
                                    <p><strong>–°—Ç–∞—Ç—É—Å:</strong> ${getStatusText(style.status)}</p>
                                </div>
                            `
                        },
                        options: {
                            preset: 'islands#blueHomeIcon',
                            iconColor: style.status === 'active' ? style.color : '#808080'
                        }
                    };
                });

                inspectorsHomesLayer.add({
                    type: 'FeatureCollection',
                    features: homeFeatures
                });
            }
        }

        // üî• –£–ü–†–ê–í–õ–ï–ù–ò–ï –ú–ï–ù–Æ
        function closeAllMenus() {
            document.getElementById('filterAccessMenu').style.display = 'none';
            document.getElementById('inspectorManagementMenu').style.display = 'none';
            activeMenu = null;
        }

        function toggleInspectorsManagement() {
            const menu = document.getElementById('inspectorManagementMenu');
            if (menu.style.display === 'flex') {
                menu.style.display = 'none';
                activeMenu = null;
            } else {
                closeAllMenus();
                menu.style.display = 'flex';
                activeMenu = 'management';
                updateInspectorManagementContent();
            }
        }

        function toggleFilterAccessMenu() {
            const menu = document.getElementById('filterAccessMenu');
            if (menu.style.display === 'flex') {
                menu.style.display = 'none';
                activeMenu = null;
            } else {
                closeAllMenus();
                menu.style.display = 'flex';
                activeMenu = 'access';
                updateFilterAccessContent();
            }
        }

        function closeInspectorManagement() {
            document.getElementById('inspectorManagementMenu').style.display = 'none';
            activeMenu = null;
        }

        function closeFilterAccessMenu() {
            document.getElementById('filterAccessMenu').style.display = 'none';
            activeMenu = null;
        }

        // üî• –£–ü–†–ê–í–õ–ï–ù–ò–ï –ò–ù–°–ü–ï–ö–¢–û–†–ê–ú–ò - –£–õ–£–ß–®–ï–ù–ù–ê–Ø –í–ï–†–°–ò–Ø
        function updateInspectorManagementContent() {
            const managementContent = document.getElementById('inspectorManagementContent');
            managementContent.innerHTML = '';
            
            const inspectors = Object.keys(window.INSPECTORS_CONFIG || {});
            
            inspectors.forEach(inspector => {
                const accordion = document.createElement('div');
                accordion.className = 'accordion';
                
                const style = getInspectorStyle(inspector);
                
                accordion.innerHTML = `
                    <div class="accordion-header" onclick="toggleAccordion(this)">
                        ${style.icon} ${inspector}
                        <span>‚ñº</span>
                    </div>
                    <div class="accordion-content">
                        ${createStatusSection(inspector, style)}
                        ${createColorSection(inspector, style)}
                        ${createIconSection(inspector, style)}
                        <button class="apply-changes-btn" onclick="applyInspectorChanges('${inspector}')">
                            üíæ –ü—Ä–∏–º–µ–Ω–∏—Ç—å –∏–∑–º–µ–Ω–µ–Ω–∏—è
                        </button>
                    </div>
                `;
                
                managementContent.appendChild(accordion);
            });
        }

        function createStatusSection(inspector, style) {
            return `
                <div class="management-section">
                    <div class="management-section-title">üìä –°—Ç–∞—Ç—É—Å –∏–Ω—Å–ø–µ–∫—Ç–æ—Ä–∞</div>
                    <select class="status-select" id="status_${inspector}" onchange="updateInspectorConfig('${inspector}', 'status', this.value)">
                        <option value="active" ${style.status === 'active' ? 'selected' : ''}>üü¢ –ê–∫—Ç–∏–≤–µ–Ω</option>
                        <option value="vacation" ${style.status === 'vacation' ? 'selected' : ''}>üèñÔ∏è –í –æ—Ç–ø—É—Å–∫–µ</option>
                        <option value="sick" ${style.status === 'sick' ? 'selected' : ''}>ü§í –ù–∞ –±–æ–ª—å–Ω–∏—á–Ω–æ–º</option>
                    </select>
                </div>
            `;
        }

        function createColorSection(inspector, style) {
            let colorOptions = '';
            availableColors.forEach(color => {
                const isSelected = style.color === color;
                colorOptions += `
                    <div class="color-option ${isSelected ? 'selected' : ''}" 
                         style="background-color: ${color}"
                         onclick="selectColor('${inspector}', '${color}')"
                         title="${color}">
                    </div>
                `;
            });
            
            return `
                <div class="management-section">
                    <div class="management-section-title">üé® –¶–≤–µ—Ç –∏–Ω—Å–ø–µ–∫—Ç–æ—Ä–∞</div>
                    <div class="management-controls">
                        <span class="color-preview" style="background-color: ${style.color}"></span>
                        <span>${style.color}</span>
                    </div>
                    <div class="color-palette">
                        ${colorOptions}
                    </div>
                </div>
            `;
        }

        function createIconSection(inspector, style) {
            let iconOptions = '<option value="">-- –í—ã–±–µ—Ä–∏—Ç–µ –∏–∫–æ–Ω–∫—É --</option>';
            Object.keys(availableIcons).forEach(icon => {
                iconOptions += `<option value="${icon}" ${style.icon === icon ? 'selected' : ''}>${icon} ${availableIcons[icon]}</option>`;
            });
            
            return `
                <div class="management-section">
                    <div class="management-section-title">üñºÔ∏è –ò–∫–æ–Ω–∫–∞ –∏–Ω—Å–ø–µ–∫—Ç–æ—Ä–∞</div>
                    <select class="icon-select" id="icon_${inspector}" onchange="updateInspectorConfig('${inspector}', 'icon', this.value)">
                        ${iconOptions}
                    </select>
                </div>
            `;
        }

        function selectColor(inspector, color) {
            updateInspectorConfig(inspector, 'color', color);
            
            const accordions = document.querySelectorAll('.accordion');
            accordions.forEach(accordion => {
                const header = accordion.querySelector('.accordion-header');
                if (header && header.textContent.includes(inspector)) {
                    const colorOptions = accordion.querySelectorAll('.color-option');
                    colorOptions.forEach(option => {
                        option.classList.remove('selected');
                        if (option.style.backgroundColor === color) {
                            option.classList.add('selected');
                        }
                    });
                    
                    const colorPreview = accordion.querySelector('.color-preview');
                    if (colorPreview) {
                        colorPreview.style.backgroundColor = color;
                    }
                }
            });
        }

        function updateInspectorConfig(inspector, field, value) {
            console.log(`üîÑ –û–±–Ω–æ–≤–ª–µ–Ω–∏–µ ${field} –¥–ª—è ${inspector}:`, value);
            
            if (window.INSPECTORS_CONFIG[inspector]) {
                window.INSPECTORS_CONFIG[inspector][field] = value;
            }
        }

        function applyInspectorChanges(inspector) {
            const style = getInspectorStyle(inspector);
            const config = {
                color: style.color,
                icon: style.icon,
                status: style.status
            };
            
            console.log(`üíæ –ü—Ä–∏–º–µ–Ω–µ–Ω–∏–µ –∏–∑–º–µ–Ω–µ–Ω–∏–π –¥–ª—è ${inspector}:`, config);
            
            // üî• –ï–°–õ–ò –°–¢–ê–¢–£–° –ò–ó–ú–ï–ù–ò–õ–°–Ø –ù–ê –ù–ï–ê–ö–¢–ò–í–ù–´–ô - –ü–ï–†–ï–î–ê–ï–ú –û–ë–™–ï–ö–¢–´ ADMIN
            const statusSelect = document.getElementById(`status_${inspector}`);
            if (statusSelect && statusSelect.value !== 'active') {
                if (confirm(`–ü–µ—Ä–µ–≤–µ—Å—Ç–∏ –∏–Ω—Å–ø–µ–∫—Ç–æ—Ä–∞ ${inspector} –≤ —Å—Ç–∞—Ç—É—Å "${getStatusText(statusSelect.value)}"? –í—Å–µ –µ–≥–æ –æ–±—ä–µ–∫—Ç—ã –±—É–¥—É—Ç –ø–µ—Ä–µ–¥–∞–Ω—ã –ò–º–ø–µ—Ä–∞—Ç–æ—Ä—É.`)) {
                    saveInspectorConfig(inspector, config, true);
                }
            } else {
                saveInspectorConfig(inspector, config, true);
            }
        }

        function saveInspectorConfig(inspector, config, applyChanges = false) {
            console.log(`üíæ –°–æ—Ö—Ä–∞–Ω–µ–Ω–∏–µ –∫–æ–Ω—Ñ–∏–≥—É—Ä–∞—Ü–∏–∏ –¥–ª—è ${inspector}:`, config);
            
            const callbackName = 'saveConfigCallback_' + Date.now();
            
            const cleanupCallback = function() {
                setTimeout(() => {
                    if (window[callbackName]) {
                        delete window[callbackName];
                        console.log('‚úÖ Callback –æ—á–∏—â–µ–Ω');
                    }
                }, 10000);
            };
            
            window[callbackName] = function(result) {
                console.log('üü° –û—Ç–≤–µ—Ç –æ—Ç —Å–µ—Ä–≤–µ—Ä–∞:', result);
                cleanupCallback();
                
                if (result.success) {
                    console.log(`‚úÖ –ö–æ–Ω—Ñ–∏–≥—É—Ä–∞—Ü–∏—è —Å–æ—Ö—Ä–∞–Ω–µ–Ω–∞ –¥–ª—è ${inspector}`);
                    
                    if (applyChanges) {
                        // üî• –ù–ï–ú–ï–î–õ–ï–ù–ù–û–ï –ü–†–ò–ú–ï–ù–ï–ù–ò–ï –ò–ó–ú–ï–ù–ï–ù–ò–ô –ö –í–°–ï–ú–£
                        updateInspectorInFilters(inspector, config);
                        
                        // üî• –ê–í–¢–û–ú–ê–¢–ò–ß–ï–°–ö–ò–ô –°–ë–†–û–° –ò –ü–†–ò–ú–ï–ù–ï–ù–ò–ï –§–ò–õ–¨–¢–†–û–í –î–õ–Ø –û–ë–ù–û–í–õ–ï–ù–ò–Ø –¶–í–ï–¢–û–í
                        deselectAllLists();
                        setTimeout(() => {
                            selectAllLists();
                            updateMap();
                        }, 100);
                        
                        // üî• –û–ë–ù–û–í–õ–Ø–ï–ú –î–û–ú–ê–®–ù–ò–ï –¢–û–ß–ö–ò
                        if (showInspectorsHomes) {
                            toggleInspectorsHomes();
                            setTimeout(() => toggleInspectorsHomes(), 200);
                        }
                    }
                    
                    if (result.transferredObjects > 0) {
                        showNotification(`‚úÖ –ö–æ–Ω—Ñ–∏–≥—É—Ä–∞—Ü–∏—è —Å–æ—Ö—Ä–∞–Ω–µ–Ω–∞. –ü–µ—Ä–µ–Ω–µ—Å–µ–Ω–æ –æ–±—ä–µ–∫—Ç–æ–≤: ${result.transferredObjects}`, 'success');
                        // üî• –ü–†–ò–ù–£–î–ò–¢–ï–õ–¨–ù–û–ï –û–ë–ù–û–í–õ–ï–ù–ò–ï –ü–†–ò –ü–ï–†–ï–î–ê–ß–ï –û–ë–™–ï–ö–¢–û–í
                        setTimeout(() => loadData(), 1000);
                    } else {
                        showNotification(`‚úÖ –ù–∞—Å—Ç—Ä–æ–π–∫–∏ –¥–ª—è ${inspector} –ø—Ä–∏–º–µ–Ω–µ–Ω—ã`, 'success');
                    }
                    
                    // üî• –ó–ê–ö–†–´–í–ê–ï–ú –ú–ï–ù–Æ –ü–û–°–õ–ï –ü–†–ò–ú–ï–ù–ï–ù–ò–Ø
                    setTimeout(() => {
                        closeInspectorManagement();
                    }, 500);
                    
                } else {
                    showNotification('‚ùå –û—à–∏–±–∫–∞ —Å–æ—Ö—Ä–∞–Ω–µ–Ω–∏—è: ' + result.message, 'error');
                }
            };
            
            const url = `${SCRIPT_URL}?action=saveInspectorConfig&inspector=${encodeURIComponent(inspector)}&config=${encodeURIComponent(JSON.stringify(config))}&callback=${callbackName}`;
            const script = document.createElement('script');
            script.src = url;
            
            script.onerror = function() {
                console.error('‚ùå –û—à–∏–±–∫–∞ –∑–∞–≥—Ä—É–∑–∫–∏ —Å–∫—Ä–∏–ø—Ç–∞');
                showNotification('‚ùå –û—à–∏–±–∫–∞ —Å–æ–µ–¥–∏–Ω–µ–Ω–∏—è —Å —Å–µ—Ä–≤–µ—Ä–æ–º', 'error');
                cleanupCallback();
            };
            
            document.head.appendChild(script);
            cleanupCallback();
        }

        function updateInspectorInFilters(inspector, config) {
            const inspectorCheckbox = document.getElementById(`insp_${inspector}`);
            if (inspectorCheckbox) {
                const parent = inspectorCheckbox.parentNode;
                if (config.color) {
                    const colorDot = parent.querySelector('.color-dot');
                    if (colorDot) {
                        colorDot.style.backgroundColor = config.color;
                    }
                }
                if (config.icon) {
                    const iconSpan = parent.querySelector('.inspector-icon');
                    if (iconSpan) {
                        iconSpan.textContent = config.icon;
                    }
                }
            }
        }

        function filterManagementInspectors() {
            const searchText = document.getElementById('searchManagement').value.toLowerCase();
            const accordions = document.querySelectorAll('#inspectorManagementContent .accordion');
            
            accordions.forEach(accordion => {
                const header = accordion.querySelector('.accordion-header');
                const inspectorName = header.textContent.toLowerCase();
                
                if (inspectorName.includes(searchText)) {
                    accordion.style.display = 'block';
                } else {
                    accordion.style.display = 'none';
                }
            });
        }

        // üî• –î–û–°–¢–£–ü –ö –§–ò–õ–¨–¢–†–ê–ú
        function updateFilterAccessContent() {
            const accessContent = document.getElementById('filterAccessContent');
            accessContent.innerHTML = '';
            
            const inspectors = Object.keys(window.INSPECTORS_CONFIG || {}).filter(inspector => 
                inspector !== 'Admin' && inspector !== '–Æ—Å—É–ø–æ–≤ –ê—Ä—Ç—É—Ä –†—É—Å–ª–∞–Ω–æ–≤–∏—á'
            );
            
            inspectors.forEach(inspector => {
                const accordion = document.createElement('div');
                accordion.className = 'accordion';
                
                const currentAccess = filterAccessSettings[inspector] || [];
                const isAllAccess = currentAccess === true;
                
                let checkboxesHTML = '';
                const otherInspectors = inspectors.filter(i => i !== inspector);
                
                otherInspectors.forEach(otherInspector => {
                    const isChecked = isAllAccess || (Array.isArray(currentAccess) && currentAccess.includes(otherInspector));
                    checkboxesHTML += `
                        <div class="filter-access-item">
                            <input type="checkbox" id="access_${inspector}_${otherInspector}" 
                                   ${isChecked ? 'checked' : ''}>
                            <label for="access_${inspector}_${otherInspector}">${otherInspector}</label>
                        </div>
                    `;
                });
                
                const allChecked = otherInspectors.every(otherInspector => {
                    const isChecked = isAllAccess || (Array.isArray(currentAccess) && currentAccess.includes(otherInspector));
                    return isChecked;
                });
                
                accordion.innerHTML = `
                    <div class="accordion-header" onclick="toggleAccordion(this)">
                        üë§ ${inspector}
                        <span>‚ñº</span>
                    </div>
                    <div class="accordion-content">
                        <button class="select-all-btn" onclick="toggleAllForInspector('${inspector}')">
                            ${allChecked ? '‚ùå –°–±—Ä–æ—Å–∏—Ç—å –≤—Å–µ—Ö' : '‚úÖ –í—ã–±—Ä–∞—Ç—å –≤—Å–µ—Ö'} –∏–Ω—Å–ø–µ–∫—Ç–æ—Ä–æ–≤
                        </button>
                        <input type="text" class="search-inspector" placeholder="–ü–æ–∏—Å–∫ –ø–æ –§–ò–û..." onkeyup="filterInspectors(this)">
                        <div class="filter-access-section">
                            <div class="filter-access-section-title">${inspector} –º–æ–∂–µ—Ç –≤–∏–¥–µ—Ç—å:</div>
                            ${checkboxesHTML}
                        </div>
                    </div>
                `;
                
                accessContent.appendChild(accordion);
            });
            
            const accessAll = document.getElementById('accessAll');
            const allHaveFullAccess = inspectors.every(inspector => {
                const currentAccess = filterAccessSettings[inspector] || [];
                return currentAccess === true;
            });
            accessAll.checked = allHaveFullAccess;
        }

        function toggleAllForInspector(inspector) {
            const accordions = document.querySelectorAll('.accordion');
            accordions.forEach(accordion => {
                const header = accordion.querySelector('.accordion-header');
                if (header && header.textContent.includes(inspector)) {
                    const content = header.nextElementSibling;
                    const checkboxes = content.querySelectorAll('input[type="checkbox"]');
                    const allChecked = Array.from(checkboxes).every(checkbox => checkbox.checked);
                    
                    checkboxes.forEach(checkbox => {
                        checkbox.checked = !allChecked;
                    });
                    
                    const button = content.querySelector('.select-all-btn');
                    if (button) {
                        button.textContent = allChecked ? '‚úÖ –í—ã–±—Ä–∞—Ç—å –≤—Å–µ—Ö –∏–Ω—Å–ø–µ–∫—Ç–æ—Ä–æ–≤' : '‚ùå –°–±—Ä–æ—Å–∏—Ç—å –≤—Å–µ—Ö –∏–Ω—Å–ø–µ–∫—Ç–æ—Ä–æ–≤';
                    }
                }
            });
        }

        function toggleAccordion(header) {
            const content = header.nextElementSibling;
            const isActive = content.classList.contains('active');
            
            document.querySelectorAll('.accordion-content').forEach(acc => {
                acc.classList.remove('active');
            });
            
            if (!isActive) {
                content.classList.add('active');
            }
        }

        function filterInspectors(searchInput) {
            const searchText = searchInput.value.toLowerCase();
            const accordionContent = searchInput.closest('.accordion-content');
            const items = accordionContent.querySelectorAll('.filter-access-item');
            
            items.forEach(item => {
                const label = item.querySelector('label');
                const inspectorName = label.textContent.toLowerCase();
                if (inspectorName.includes(searchText)) {
                    item.style.display = 'flex';
                } else {
                    item.style.display = 'none';
                }
            });
        }

        function filterAccessInspectors() {
            const searchText = document.getElementById('searchAccess').value.toLowerCase();
            const accordions = document.querySelectorAll('#filterAccessContent .accordion');
            
            accordions.forEach(accordion => {
                const header = accordion.querySelector('.accordion-header');
                const inspectorName = header.textContent.toLowerCase();
                
                if (inspectorName.includes(searchText)) {
                    accordion.style.display = 'block';
                } else {
                    accordion.style.display = 'none';
                }
            });
        }

        function toggleAllFilterAccess() {
            const accessAll = document.getElementById('accessAll').checked;
            const checkboxes = document.querySelectorAll('#filterAccessContent input[type="checkbox"]');
            
            checkboxes.forEach(checkbox => {
                checkbox.checked = accessAll;
            });
        }

        function saveFilterAccess() {
            const inspectors = Object.keys(window.INSPECTORS_CONFIG || {}).filter(inspector => 
                inspector !== 'Admin' && inspector !== '–Æ—Å—É–ø–æ–≤ –ê—Ä—Ç—É—Ä –†—É—Å–ª–∞–Ω–æ–≤–∏—á'
            );
            const newSettings = {};
            
            const accessAll = document.getElementById('accessAll').checked;
            
            if (accessAll) {
                inspectors.forEach(inspector => {
                    newSettings[inspector] = true;
                });
            } else {
                inspectors.forEach(inspector => {
                    const visibleInspectors = [];
                    inspectors.forEach(otherInspector => {
                        if (otherInspector !== inspector) {
                            const checkbox = document.getElementById(`access_${inspector}_${otherInspector}`);
                            if (checkbox && checkbox.checked) {
                                visibleInspectors.push(otherInspector);
                            }
                        }
                    });
                    newSettings[inspector] = visibleInspectors;
                });
            }
            
            showNotification('üîÑ –°–æ—Ö—Ä–∞–Ω—è–µ–º –Ω–∞—Å—Ç—Ä–æ–π–∫–∏ –¥–æ—Å—Ç—É–ø–∞...', 'success');
            
            const callbackName = 'saveAccessCallback_' + Date.now();
            
            const cleanupCallback = function() {
                setTimeout(() => {
                    if (window[callbackName]) {
                        delete window[callbackName];
                    }
                }, 10000);
            };
            
            window[callbackName] = function(result) {
                cleanupCallback();
                if (result.success) {
                    showNotification('‚úÖ –ù–∞—Å—Ç—Ä–æ–π–∫–∏ –¥–æ—Å—Ç—É–ø–∞ —Å–æ—Ö—Ä–∞–Ω–µ–Ω—ã', 'success');
                    filterAccessSettings = newSettings;
                    closeFilterAccessMenu();
                    initInterface();
                } else {
                    showNotification('‚ùå –û—à–∏–±–∫–∞ —Å–æ—Ö—Ä–∞–Ω–µ–Ω–∏—è: ' + result.message, 'error');
                }
            };
            
            const url = `${SCRIPT_URL}?action=saveFilterAccessSettings&settings=${encodeURIComponent(JSON.stringify(newSettings))}&callback=${callbackName}`;
            const script = document.createElement('script');
            script.src = url;
            
            script.onerror = function() {
                cleanupCallback();
                showNotification('‚ùå –û—à–∏–±–∫–∞ —Å–æ–µ–¥–∏–Ω–µ–Ω–∏—è —Å —Å–µ—Ä–≤–µ—Ä–æ–º', 'error');
            };
            
            document.head.appendChild(script);
            cleanupCallback();
        }

        // üî• –í–°–ü–û–ú–û–ì–ê–¢–ï–õ–¨–ù–´–ï –§–£–ù–ö–¶–ò–ò
function selectAllInspectors() {
            const inspectorCheckboxes = document.querySelectorAll('#inspectorsList input[type="checkbox"]');
            inspectorCheckboxes.forEach(checkbox => checkbox.checked = true);
            updateFilters();
            saveFilterState();
        }

        function deselectAllInspectors() {
            const inspectorCheckboxes = document.querySelectorAll('#inspectorsList input[type="checkbox"]');
            inspectorCheckboxes.forEach(checkbox => checkbox.checked = false);
            updateFilters();
            saveFilterState();
        }
    

        function deselectAllInspectors() {
            const inspectorCheckboxes = document.querySelectorAll('#inspectorsList input[type="checkbox"]');
            inspectorCheckboxes.forEach(checkbox => checkbox.checked = false);
            updateFilters();
        }

        function filterInspectorsList() {
            const searchText = document.getElementById('searchInspectors').value.toLowerCase();
            const inspectorItems = document.querySelectorAll('#inspectorsList .checkbox-item');
            
            inspectorItems.forEach(item => {
                const label = item.querySelector('label');
                const inspectorName = label.textContent.toLowerCase();
                if (inspectorName.includes(searchText)) {
                    item.style.display = 'flex';
                } else {
                    item.style.display = 'none';
                }
            });
        }

       function selectAllLists() {
            const listCheckboxes = document.querySelectorAll('#listsList input[type="checkbox"]');
            listCheckboxes.forEach(checkbox => checkbox.checked = true);
            updateFilters();
            saveFilterState();
        }

        function deselectAllLists() {
            const listCheckboxes = document.querySelectorAll('#listsList input[type="checkbox"]');
            listCheckboxes.forEach(checkbox => checkbox.checked = false);
            updateFilters();
            saveFilterState();
        }

        function onInspectorChange() {
            updateFilters();
            saveFilterState();
            updateListCounters();
        }

        function onListChange() {
            updateFilters();
            saveFilterState();
        }

        function updateFilters() {
            updateMap();
        }

        function switchTab(tabName) {
            document.querySelectorAll('.tab-button').forEach(btn => btn.classList.remove('active'));
            document.querySelectorAll('.tab-pane').forEach(pane => pane.classList.remove('active'));
            
            document.querySelector(`.tab-button[onclick="switchTab('${tabName}')"]`).classList.add('active');
            document.getElementById(`${tabName}-tab`).classList.add('active');
            
            if (tabName === 'objects') {
                updateObjectsList();
            }
        }

        function updateObjectsList() {
            const objectsListContent = document.getElementById('objectsListContent');
            const searchText = document.getElementById('searchListInput').value.toLowerCase();
            const filteredObjects = getFilteredObjects().filter(obj => {
                if (!searchText) return true;
                
                return obj.id.toString().toLowerCase().includes(searchText) ||
                       obj.address.toLowerCase().includes(searchText);
            });
            
            if (filteredObjects.length === 0) {
                objectsListContent.innerHTML = '<div class="loading">–ù–µ—Ç –æ–±—ä–µ–∫—Ç–æ–≤ –¥–ª—è –æ—Ç–æ–±—Ä–∞–∂–µ–Ω–∏—è</div>';
                return;
            }
            
            objectsListContent.innerHTML = '';
            
            filteredObjects.forEach(obj => {
                const style = getInspectorStyle(obj.inspector);
                
                const isNew = !obj.entryTime && !obj.exitTime;
                const isActive = obj.entryTime && !obj.exitTime;
                const isCompleted = !!obj.exitTime;
                
                let statusClass = 'status-new';
                let statusText = 'üÜï';
                if (isCompleted) {
                    statusClass = 'status-completed';
                    statusText = '‚úÖ';
                } else if (isActive) {
                    statusClass = 'status-active';
                    statusText = 'üîµ';
                }
                
                const objectItem = document.createElement('div');
                objectItem.className = 'object-item';
                objectItem.onclick = () => {
                    map.setCenter([parseFloat(obj.latitude), parseFloat(obj.longitude)], 17);
                    showObjectBalloon(obj.id);
                };
                
                objectItem.innerHTML = `
                    <div style="flex: 1;">
                        <div class="object-id">${obj.id}</div>
                        <div class="object-address">${obj.address}</div>
                        <div class="object-inspector">${obj.inspector || '–ù–µ –Ω–∞–∑–Ω–∞—á–µ–Ω'}</div>
                    </div>
                    <span class="object-status ${statusClass}">
                        ${statusText}
                    </span>
                `;
                objectsListContent.appendChild(objectItem);
            });
        }

        function updateStats(filteredObjects) {
            const totalObjects = objectsData.length;
            const shownObjects = filteredObjects.length;
            
            const totalCompletedObjects = objectsData.filter(obj => obj.exitTime && obj.exitTime !== '').length;
            const totalActiveObjects = objectsData.filter(obj => obj.entryTime && !obj.exitTime).length;
            
            document.getElementById('objectsCounter').textContent = `–ü–æ–∫–∞–∑–∞–Ω–æ: ${shownObjects} –∏–∑ ${totalObjects} –æ–±—ä–µ–∫—Ç–æ–≤`;
            document.getElementById('completedCounter').textContent = `–í—ã–ø–æ–ª–Ω–µ–Ω–æ: ${totalCompletedObjects} –æ–±—ä–µ–∫—Ç–æ–≤`;
            document.getElementById('activeCounter').textContent = `–ê–∫—Ç–∏–≤–Ω—ã—Ö: ${totalActiveObjects} –æ–±—ä–µ–∫—Ç–æ–≤`;
        }

        function showLoading(message) {
            document.getElementById('inspectorsList').innerHTML = `<div class="loading">${message}</div>`;
            document.getElementById('listsList').innerHTML = `<div class="loading">${message}</div>`;
        }

        function showError(message) {
            document.getElementById('inspectorsList').innerHTML = `<div class="error">${message}</div>`;
            document.getElementById('listsList').innerHTML = `<div class="error">${message}</div>`;
        }

        function showNotification(message, type = 'success') {
            const existingNotifications = document.querySelectorAll('.notification');
            existingNotifications.forEach(note => note.remove());
            
            const notification = document.createElement('div');
            notification.className = `notification ${type}`;
            notification.textContent = message;
            
            document.body.appendChild(notification);
            
            setTimeout(() => {
                if (notification.parentNode) {
                    notification.remove();
                }
            }, 5000);
        }

        // üî• –û–ë–†–ê–ë–û–¢–ß–ò–ö–ò –°–û–ë–´–¢–ò–ô –î–õ–Ø –û–ë–ù–û–í–õ–ï–ù–ò–Ø –°–ï–°–°–ò–ò
        document.addEventListener('click', function() {
            if (currentUser) {
                saveSession();
            }
        });

        document.addEventListener('visibilitychange', function() {
            if (!document.hidden && currentUser) {
                saveSession();
            }
        });

        // üî• –ó–ê–ö–†–´–¢–ò–ï –ú–ï–ù–Æ –ü–û –ö–õ–ò–ö–£ –ù–ê –ö–ê–†–¢–£
        document.getElementById('map').addEventListener('click', function(e) {
            if (activeMenu && e.target.closest('.filter-access-menu, .inspector-management-menu') === null) {
                closeAllMenus();
            }
        });
    </script>
</body>
</html>
